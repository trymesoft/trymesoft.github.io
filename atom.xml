<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Star Wang</title>
  <icon>https://www.gravatar.com/avatar/13a05b1c3501d56e3910ce7b38f002a3</icon>
  <subtitle>To see the new world!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://tryme.wang/"/>
  <updated>2019-02-28T03:27:17.359Z</updated>
  <id>https://tryme.wang/</id>
  
  <author>
    <name>Star Wang</name>
    <email>tryme.wang@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Typecho ç›¸å…³æ”¹åŠ¨</title>
    <link href="https://tryme.wang/2019/02/typecho-changes/"/>
    <id>https://tryme.wang/2019/02/typecho-changes/</id>
    <published>2019-02-27T16:53:49.000Z</published>
    <updated>2019-02-28T03:27:17.359Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è®°å½• Typecho æˆ–å…¶ä¸»é¢˜æœ‰å…³æ”¹åŠ¨ã€‚</p></blockquote><h3 id="è¯„è®ºæ˜¾ç¤º-User-Agent"><a href="#è¯„è®ºæ˜¾ç¤º-User-Agent" class="headerlink" title="è¯„è®ºæ˜¾ç¤º User Agent"></a>è¯„è®ºæ˜¾ç¤º User Agent</h3><p>ä½¿ç”¨æ’ä»¶å®ç°ï¼Œæ’ä»¶<a href="https://github.com/ennnnny/typecho" target="_blank" rel="noopener">åœ°å€</a>ã€‚</p><ol><li>ä¸‹è½½åå°†å…¶ä¸Šä¼ åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ <code>usr/plugins</code> æ–‡ä»¶å¤¹å¹¶è§£å‹ï¼Œå†…å«ä¸¤ä¸ªæ’ä»¶ã€‚</li><li><p>è¿™æ—¶å¯ä»¥ç™»å½•ç½‘ç«™ç®¡ç†åå°é…ç½®å¹¶å¯ç”¨ï¼š<img src="https://ws4.sinaimg.cn/large/007jb4T5gy1g0lytvuu4aj30ue0nkwfp.jpg" alt="image" align="center"></p></li><li><p>ä¿®æ”¹è¯„è®ºé¡µé¢ä»£ç ï¼Œé…ç½® UA æ˜¾ç¤ºä½ç½®ï¼Œ<code>Handsome</code> ä¸»é¢˜ä¿®æ”¹ä¸»é¢˜æ ¹ç›®å½•ä¸‹çš„ <code>component/comments.php</code>ï¼Œå¤§è‡´ä½ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1g0lyz7p3itj318g0ckq5u.jpg" alt="image" align="center"></p></li><li><p>æŸ¥çœ‹è¯„è®ºæ•ˆæœï¼š</p><p><img src="https://ws2.sinaimg.cn/large/007jb4T5ly1g0lz14o2ksj30qw06q3yt.jpg" alt="image" align="center"></p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;è®°å½• Typecho æˆ–å…¶ä¸»é¢˜æœ‰å…³æ”¹åŠ¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;è¯„è®ºæ˜¾ç¤º-User-Agent&quot;&gt;&lt;a href=&quot;#è¯„è®ºæ˜¾ç¤º-User-Agent&quot; class=&quot;headerlink&quot; title=&quot;è¯„è®ºæ˜¾ç¤º Us
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Typecho" scheme="https://tryme.wang/tags/Typecho/"/>
    
  </entry>
  
  <entry>
    <title>é¡¹ç›®ä¸­çš„ä¸€è‡´æ€§å“ˆå¸Œä½¿ç”¨</title>
    <link href="https://tryme.wang/2019/02/consistency-hash-usage/"/>
    <id>https://tryme.wang/2019/02/consistency-hash-usage/</id>
    <published>2019-02-19T12:53:49.000Z</published>
    <updated>2019-02-27T09:38:08.502Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸ç”¨çš„ç®—æ³•ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½å¤±æ•ˆï¼Œå¹¶ä¸”æ–°çš„èŠ‚ç‚¹å¾ˆå¯èƒ½åŠ¨æ€çš„å¢åŠ è¿›æ¥ï¼Œæ‰€ä»¥ï¼Œå½“èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸Šé¢çš„æ•°æ®è¦ä¿æŒå°½å¯èƒ½å°çš„æŒ¯è¡ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®¹é”™æ€§åŠå¯æ‰©å±•æ€§å¾ˆé«˜ã€‚</p></blockquote><h3 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h3><blockquote><p>é¡¹ç›®ä¸­ä½¿ç”¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é•¿è¿æ¥ï¼Œè€ƒè™‘åˆ°æœåŠ¡çš„å¯ç”¨æ€§ï¼Œå¿…ç„¶è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼Œä½†æ˜¯æœ€å¸¸è§çš„ Nginx æ˜¯ HTTP çš„è´Ÿè½½å‡è¡¡ä¸åå‘ä»£ç†æœåŠ¡å™¨ï¼Œé•¿è¿æ¥çš„è´Ÿè½½å‡è¡¡è¿˜éœ€è¦å…¶ä»–çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><p>æœ€ç»ˆé€‰ç”¨äº† ZooKeeper åŠä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†é…èŠ‚ç‚¹ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><ol><li>é¡¹ç›®å¯åŠ¨æ—¶åœ¨ ZooKeeper é›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å¹¶åŒæ­¥åˆå§‹åŒ–å“ˆå¸Œç¯ï¼ˆä¿è¯å“ˆå¸Œç¯èŠ‚ç‚¹å’ŒæœåŠ¡å™¨èŠ‚ç‚¹åŒæ­¥ï¼‰ï¼›</li><li>å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä½¿ç”¨åŒä¸€ç§ Hash å‡½æ•°è®¡ç®—å‡ºè¯¥å®¢æˆ·ç«¯å¯¹åº”çš„ Hash å€¼æ¥åˆ†é…èŠ‚ç‚¹ï¼Œè¿”å›è¯¥å®¢æˆ·ç«¯è¿æ¥çš„å…·ä½“èŠ‚ç‚¹ä¿¡æ¯å¹¶ä¿å­˜åˆ° Redis ä¸­ï¼Œé˜²æ­¢é‡å¤åˆ†é…ï¼Œå®šæ—¶è¿‡æœŸé‡æ–°åˆ†é…ï¼›</li><li>å½“å“ˆå¸Œç¯ä¸­çš„æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œæ ¹æ®é…ç½®å¥½çš„ Watcherï¼Œè¿›è¡Œå“ˆå¸Œç¯èŠ‚ç‚¹æ›´æ–°æ“ä½œï¼›</li><li>å½“æ–°å¢èŠ‚ç‚¹æ—¶ï¼Œé‡å¤æ­¥éª¤ 1ã€‚</li></ol><blockquote><p><code>Watcher</code>ï¼šZooKeeper æ”¯æŒä¸€ç§ Watch æ“ä½œï¼ŒClient å¯ä»¥åœ¨æŸä¸ª ZNode ä¸Šè®¾ç½®ä¸€ä¸ª Watcherï¼Œæ¥ Watch è¯¥ ZNode ä¸Šçš„å˜åŒ–ã€‚å¦‚æœè¯¥ ZNode ä¸Šæœ‰ç›¸åº”çš„å˜åŒ–ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ª Watcherï¼ŒæŠŠç›¸åº”çš„äº‹ä»¶é€šçŸ¥ç»™è®¾ç½® Watcher çš„ Clientã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒZooKeeper ä¸­çš„ Watcher æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå³è§¦å‘ä¸€æ¬¡å°±ä¼šè¢«å–æ¶ˆï¼Œå¦‚æœæƒ³ç»§ç»­ Watch çš„è¯ï¼Œéœ€è¦å®¢æˆ·ç«¯é‡æ–°è®¾ç½® Watcherã€‚</p></blockquote><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>ZooKeeper åˆå§‹åŒ–åŠåˆ›å»ºèŠ‚ç‚¹ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        zk = <span class="keyword">new</span> ZooKeeper(conf.getConnectionStr(), conf.getSessionTimeout(), <span class="keyword">new</span> ZookeeperWatcher());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == zk.exists(conf.getZkNode(), <span class="keyword">true</span>)) &#123;</span><br><span class="line">            zk.create(conf.getZkNode(), <span class="string">""</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createNode</span><span class="params">(String node, String parentNode)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"zookeeperåˆ›å»ºèŠ‚ç‚¹ =&gt; &#123;&#125;"</span>, node);</span><br><span class="line">    zk.create(parentNode + <span class="string">"/"</span> + node, <span class="string">""</span>.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ ZookeeperWatcherï¼Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ZookeeperWatcher</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"æ³¨å†Œä¸­å¿ƒæ”¶åˆ°äº‹ä»¶ =&gt; &#123;&#125;"</span>, event);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (KeeperState.SyncConnected == event.getState() &amp;&amp; <span class="keyword">null</span> == event.getPath()) &#123;</span><br><span class="line">            logger.info(<span class="string">"å·²è¿æ¥zookeeperæœåŠ¡å™¨"</span>);</span><br><span class="line">            cdl.countDown();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (EventType.NodeChildrenChanged == event.getType()) &#123;</span><br><span class="line">            logger.info(<span class="string">"èŠ‚ç‚¹ &#123;&#125; &#123;&#125;"</span>, event.getPath(), <span class="string">"çš„å­èŠ‚ç‚¹å‘ç”Ÿå˜æ›´..."</span>);</span><br><span class="line">            <span class="keyword">if</span> (!conf.getZkNode().equals(event.getPath())) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;String&gt; children = regCenter.getChild();</span><br><span class="line">            logger.info(<span class="string">"æ›´æ–°å“ˆå¸Œç¯åˆ—è¡¨ =&gt; &#123;&#125;"</span>, children);</span><br><span class="line">            ConsistencyHash.init(children);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åˆå§‹åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çœŸå®æœåŠ¡å™¨ä¿¡æ¯+è™šæ‹ŸèŠ‚ç‚¹æœåŠ¡å™¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> TreeMap&lt;Long, String&gt; nodes = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çœŸå®æœåŠ¡å™¨èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; shards = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®è™šæ‹ŸèŠ‚ç‚¹æ•°ç›®(æ¯ä¸ªçœŸå®è´Ÿè½½èŠ‚ç‚¹åŒæ—¶å­˜åœ¨çš„è™šæ‹ŸèŠ‚ç‚¹)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> VIRTUAL_NUM = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–ä¸€è‡´æ€§ hash ç¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shards çœŸå®æœåŠ¡å™¨èŠ‚ç‚¹ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(List&lt;String&gt; shards)</span> </span>&#123;</span><br><span class="line">    TreeMap&lt;Long, String&gt; nodes = <span class="keyword">new</span> TreeMap&lt;Long, String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shards.size(); i++) &#123;</span><br><span class="line">        String shardInfo = shards.get(i);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; VIRTUAL_NUM; j++) &#123;</span><br><span class="line">            nodes.put(hash(computeMd5(<span class="string">"SHARD-"</span> + i + <span class="string">"-NODE-"</span> + j), j),</span><br><span class="line">                    shardInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ConsistencyHash.nodes = nodes;</span><br><span class="line">    ConsistencyHash.shards = shards;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ® key çš„ hash å€¼åˆ†é…èŠ‚ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®keyçš„hashå€¼å–å¾—æœåŠ¡å™¨èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getShardInfo</span><span class="params">(<span class="keyword">long</span> hash)</span> </span>&#123;</span><br><span class="line">    Long key = hash;</span><br><span class="line">    SortedMap&lt;Long, String&gt; tailMap = nodes.tailMap(key);</span><br><span class="line">    <span class="keyword">if</span> (tailMap.isEmpty()) &#123;</span><br><span class="line">        key = nodes.firstKey();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        key = tailMap.firstKey();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nodes.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æµ‹ï¼Œåˆ†é… 10 ä¸‡ä¸ª keyï¼Œå¤§è‡´å¯ä»¥å‡åŒ€åˆ†å¸ƒåœ¨ 3 ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ZooKeeper é›†ç¾¤è‡³å°‘ 3 å°ï¼Œæ‰èƒ½ä¿è¯ä¸ä½äºä¸€åŠèŠ‚ç‚¹å·¥ä½œï¼ŒZooKeeper çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨åŠ¨æ€æ·»åŠ æˆ–è€…èŠ‚ç‚¹å®•æœºæ—¶æ— éœ€æ‰‹åŠ¨æˆ–ä»£ç ä¾µå…¥çš„åŒæ­¥å“ˆå¸Œç¯ï¼Œé€šè¿‡å…¶å†…éƒ¨çš„ Watcher æœºåˆ¶å³å¯æ–¹ä¾¿çš„å®ç°ã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯åˆ†é…èŠ‚ç‚¹ä¿¡æ¯çš„ä¸»ç®—æ³•ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒèŠ‚ç‚¹å˜åŒ–æ—¶é˜²æ­¢æŸä¸ªèŠ‚ç‚¹è´Ÿè½½çªç„¶å˜å¤§å¹¶ä¸”å°½å¯èƒ½çš„å‡åŒ€åˆ†é…ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸ç”¨çš„ç®—æ³•ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½å¤±æ•ˆï¼Œå¹¶ä¸”æ–°çš„èŠ‚ç‚¹å¾ˆå¯èƒ½åŠ¨æ€çš„å¢åŠ è¿›æ¥ï¼Œæ‰€ä»¥ï¼Œå½“èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸Šé¢çš„æ•°æ®è¦ä¿æŒå°½å¯èƒ½å°çš„æŒ¯è¡ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®¹é”™æ€§åŠå¯æ‰©å±•æ€§å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å·¥ä½œè®°å½•" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="Java" scheme="https://tryme.wang/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</title>
    <link href="https://tryme.wang/2019/02/consistency-hash/"/>
    <id>https://tryme.wang/2019/02/consistency-hash/</id>
    <published>2019-02-19T04:53:49.000Z</published>
    <updated>2019-02-27T09:36:25.656Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><blockquote><p>å¼€å‘é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¹¶æœªç³»ç»Ÿæ€»ç»“è¿‡ç›¸å…³çŸ¥è¯†ï¼Œè¶æ­¤æœºä¼šæ€»ç»“ä¸‹ã€‚</p></blockquote><p><strong>ä¸€è‡´å“ˆå¸Œ</strong> æ˜¯ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•ã€‚åœ¨ä½¿ç”¨ä¸€è‡´å“ˆå¸Œç®—æ³•åï¼Œå“ˆå¸Œè¡¨æ§½ä½æ•°ï¼ˆå¤§å°ï¼‰çš„æ”¹å˜å¹³å‡åªéœ€è¦å¯¹ <code>K/n</code>  ä¸ªå…³é”®å­—é‡æ–°æ˜ å°„ï¼Œå…¶ä¸­ <code>K</code> æ˜¯å…³é”®å­—çš„æ•°é‡ï¼Œ<code>n</code> æ˜¯æ§½ä½æ•°é‡ã€‚ç„¶è€Œåœ¨ä¼ ç»Ÿçš„å“ˆå¸Œè¡¨ä¸­ï¼Œæ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªæ§½ä½çš„å‡ ä¹éœ€è¦å¯¹æ‰€æœ‰å…³é”®å­—è¿›è¡Œé‡æ–°æ˜ å°„ã€‚  â€“<strong>Wikipedia</strong></p><p>é€šä¿—ç‚¹è¯´ï¼Œ<code>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</code>æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸è§çš„ç®—æ³•ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼çš„å­˜å‚¨ç³»ç»Ÿï¼Œè¦å°†æ•°æ®å­˜å‚¨åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœé‡‡ç”¨æ™®é€šçš„ Hash æ–¹æ³•ï¼Œå°†æ•°æ®æ˜ å°„åˆ°å…·ä½“çš„èŠ‚ç‚¹ä¸Šï¼Œå¦‚ key%Nï¼Œkey æ˜¯æ•°æ®çš„å€¼ï¼ŒN æ˜¯æœºå™¨èŠ‚ç‚¹æ•°ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½å¤±æ•ˆï¼Œå¹¶ä¸”æ–°çš„èŠ‚ç‚¹å¾ˆå¯èƒ½åŠ¨æ€çš„å¢åŠ è¿›æ¥ï¼Œè¿™æ ·çš„è¯æ™®é€šçš„å“ˆå¸Œå–æ¨¡ç®—æ³•ä¼šé€ æˆç¼“å­˜çš„å·¨å¤§æŒ¯è¡ï¼Œå‡ ä¹æ‰€æœ‰çš„æ•°æ®æ˜ å°„éƒ½ä¼šæ— æ•ˆã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å¦‚ä¸‹å›¾ï¼Œä¸€ä¸ª Hash ç¯ä¸Šå€¼ç©ºé—´ä¸º 0 - 2<sup>32</sup> ï¼ŒæŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„åˆï¼Œä¸Šæœ‰ Aã€Bã€Cã€D å››ä¸ª Hash å‡ºæ¥çš„èŠ‚ç‚¹ã€‚</p><p><img src="https://wx1.sinaimg.cn/large/007jb4T5ly1g0f6utlwm5j30md0m3tcj.jpg" alt="image" align="center"></p><p>å½“å®šä½æŸä¸ª key çš„ä½ç½®æ—¶ï¼Œä½¿ç”¨ç›¸åŒçš„ Hash å‡½æ•°è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶æŒ‰é¡ºæ—¶é’ˆæ‰¾åˆ°ç›¸åº”èŠ‚ç‚¹åŒºé—´ï¼Œé¡ºæ—¶é’ˆçš„ä¸‹ä¸€èŠ‚ç‚¹å³ä¸ºå…¶ç›¸åº”çš„æœåŠ¡å™¨ã€‚</p><p>å‡è®¾æœ‰ Object Aã€Object Bã€Object Cã€Object D å››ä¸ª keyï¼Œåœ¨ä½¿ç”¨åŒæ ·çš„ Hash å‡½æ•°è®¡ç®—åï¼Œå…¶ä½ç½®å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://wx3.sinaimg.cn/large/007jb4T5ly1g0f70dkog9j30kq0ljgre.jpg" alt="image" align="center"></p><p>åˆ™é¡ºæ—¶é’ˆå¯»æ‰¾ï¼ŒObject Aä¼šè¢«å®šä¸ºåˆ° Node A ä¸Šï¼ŒObject B è¢«å®šä¸ºåˆ° Node B ä¸Šï¼ŒObject C è¢«å®šä¸ºåˆ° Node C ä¸Šï¼ŒObject D è¢«å®šä¸ºåˆ° Node D ä¸Šã€‚</p><p>æ­¤æ—¶å¦‚è‹¥èŠ‚ç‚¹ C å®•æœºï¼Œåˆ™åªä¼šå½±å“èŠ‚ç‚¹ B åˆ° C ä¹‹é—´çš„æ•°æ®ï¼Œå…¶è¢«å®šä½åˆ° D èŠ‚ç‚¹ä¸Šï¼Œè€Œ Aã€Bã€D ä¸Šçš„åŸæ•°æ®ä¸ä¼šè¢«å½±å“ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§ã€‚</p><p>å¦‚æœæ˜¯æ–°åŠ ä¸€ä¸ªèŠ‚ç‚¹ Xï¼Œå¦‚ä¸‹å›¾ï¼š</p><p>â€‹<img src="https://wx2.sinaimg.cn/large/007jb4T5ly1g0f7608hekj30kl0l3wkx.jpg" alt="image" align="center"></p><p>å—å½±å“çš„æ•°æ®ä¸ºèŠ‚ç‚¹ B åˆ° C ä¹‹é—´çš„ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚</p><h3 id="Hash-ç¯çš„æ•°æ®å€¾æ–œé—®é¢˜"><a href="#Hash-ç¯çš„æ•°æ®å€¾æ–œé—®é¢˜" class="headerlink" title="Hash ç¯çš„æ•°æ®å€¾æ–œé—®é¢˜"></a>Hash ç¯çš„æ•°æ®å€¾æ–œé—®é¢˜</h3><p>å½“ Hash ç¯ä¸ŠèŠ‚ç‚¹æ•°é‡è¾ƒå°‘æ—¶ï¼Œå¾ˆå¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤šæ•°æ®è¢«å®šä½åˆ°å…¶ä¸­ä¸€å°ä¸Šï¼Œå…¶ä»–èŠ‚ç‚¹æ•°æ®æå°‘çš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1g0f78hrmmfj30cc0d5dfy.jpg" alt="image" align="center"></p><p>å¯ä»¥å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹ï¼Œå³æ¯å°æœåŠ¡å™¨è™šæ‹Ÿå‡ºå‡ ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥å°½å¯èƒ½çš„å‡åŒ€åˆ†å¸ƒï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1g0f7c6edj1j30k00kbaaj.jpg" alt="image" align="center"></p><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/34985026" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34985026</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;å¼€å‘é¡¹ç›®ä¸­ç”¨åˆ°äº†ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¹¶æœªç³»ç»Ÿæ€»ç»“è¿‡ç›¸å…³çŸ¥è¯†ï¼Œè¶æ­¤æœºä¼šæ€»ç»“ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ç®—æ³•" scheme="https://tryme.wang/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Hexo åšå®¢æœç´¢çš„é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/hexo-search-problem/"/>
    <id>https://tryme.wang/2019/01/hexo-search-problem/</id>
    <published>2019-01-17T02:53:49.000Z</published>
    <updated>2019-01-17T07:54:06.956Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ•´ç† Hexo åšå®¢æ—¶ï¼Œå‘ç°é¡µé¢æœç´¢åŠŸèƒ½ä¸å¥½ç”¨ï¼Œä¹‹å‰ä¸€ç›´æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç‚¹å‡»â€œæœç´¢â€åï¼Œé¡µé¢ä¸­é—´æ€»æ˜¯æ˜¾ç¤ºåŠ è½½ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://wx3.sinaimg.cn/large/007jb4T5ly1fz9lvnvye7j30lk08mjrw.jpg" alt="image" align="center"></p></blockquote><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>é¦–å…ˆå°è¯•é‡è£…æ’ä»¶ï¼Œæœç´¢æ’ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"hexo-site"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.0"</span>,</span><br><span class="line">  <span class="attr">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"hexo"</span>: &#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"3.6.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    "hexo-generator-search": "^2.2.1",</span><br><span class="line">    "hexo-generator-searchdb": "^1.0.8",</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†æœç´¢çš„æ’ä»¶é‡è£…ä¹‹åè²Œä¼¼è¿˜æ˜¯ä¸è¡Œï¼Œå¤±è´¥ï¼</p><p>ä¹‹åæ€€ç–‘æ˜¯é…ç½®çš„é—®é¢˜ï¼ŒæŸ¥äº†ä¸‹æ’ä»¶<a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener">å¼€å‘è€…</a>ä½¿ç”¨æ–¹æ³•ï¼š</p><p><img src="https://ws4.sinaimg.cn/large/007jb4T5ly1fz9m12iixlj31fe0o20x4.jpg" alt="image" align="center"></p><p>å¯¹ç…§è‡ªå·±çš„é…ç½®ï¼Œä¹Ÿæ— é—®é¢˜ï¼Œå¤±è´¥ï¼</p><p>åæ¥ï¼Œè”æƒ³åˆ°æœç´¢å°†å†…å®¹è¾“å‡ºåˆ°äº†æ ¹ç›®å½•çš„ <code>search.xml</code> æ–‡ä»¶ä¸­ï¼Œç›´æ¥æœ¬åœ°è°ƒè¯•è®¿é—® <a href="http://localhost:4000/search.xmlï¼Œå‘ç°äº†æŠ¥é”™ï¼š" target="_blank" rel="noopener">http://localhost:4000/search.xmlï¼Œå‘ç°äº†æŠ¥é”™ï¼š</a></p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fz9m560vgxj31xu0gkwlq.jpg" alt="image" align="center"></p><p>æœç„¶æœ‰é—®é¢˜ï¼Œå»æŸ¥çœ‹ <code>157è¡Œ 335åˆ—</code>ï¼š</p><p><img src="https://ws2.sinaimg.cn/large/007jb4T5ly1fz9mcshvxej31a40huq5x.jpg" alt="image" align="center"></p><p>å§æ§½ï¼Œå¤šäº†ä¸ªçº¢ç‚¹ï¼Œä¼°è®¡æ˜¯å¤åˆ¶çš„æ—¶å€™å¤šäº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ï¼Œå°†åŸæ–‡å¤åˆ¶åˆ° <code>Sublime Text</code> ä¸­æŸ¥çœ‹ï¼Œå‘ç°æœç„¶æ˜¯æœ‰ä¸œè¥¿ï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fz9mg50d3lj30q903nwex.jpg" alt="image" align="center"></p><p>ä¸çŸ¥é“å“ªé‡Œæ¥çš„ğŸ˜¢ï¼Œåˆ é™¤åé‡æ–°è°ƒè¯•ï¼Œä¸€åˆ‡æ­£å¸¸ğŸ™ƒï¼</p><p>å‚è€ƒï¼š<a href="https://www.itfanr.cc/2017/11/24/resolve-hexo-blog-search-exception/" target="_blank" rel="noopener">ITèŒƒå„¿</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ•´ç† Hexo åšå®¢æ—¶ï¼Œå‘ç°é¡µé¢æœç´¢åŠŸèƒ½ä¸å¥½ç”¨ï¼Œä¹‹å‰ä¸€ç›´æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç‚¹å‡»â€œæœç´¢â€åï¼Œé¡µé¢ä¸­é—´æ€»æ˜¯æ˜¾ç¤ºåŠ è½½ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://wx3.sinaimg.cn/large/007jb4T5ly1fz9lvnvye
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Hexo" scheme="https://tryme.wang/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>MySQL è¿æ¥çš„é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/mysql-connect-problem/"/>
    <id>https://tryme.wang/2019/01/mysql-connect-problem/</id>
    <published>2019-01-16T12:18:27.000Z</published>
    <updated>2019-01-17T06:45:06.997Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æŸä¸ªé¡¹ç›®å¯åŠ¨æ—¶è¶…æ…¢ï¼Œå¯åŠ¨åˆ°ä¸€åŠè¿›ç¨‹è‡ªåŠ¨åœæ‰ï¼Œæœ‰çš„æ—¶å€™ååˆ†é’Ÿæ‰èƒ½å¯åŠ¨ï¼Œé‡å¤æµ‹è¯•åå‘ç°æ˜¯æ•°æ®åº“è¿æ¥çš„é—®é¢˜ã€‚</p></blockquote><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li><p>Spring Framework æ•´åˆ Druid é…ç½® DataSource</p></li><li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"SELECT 1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnReturn"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"25200000"</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>MySQL 5.7</p></li></ul><hr><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å¼‚å¸¸æ—¥å¿—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">The last packet successfully received from the server was <span class="number">540</span>,<span class="number">992</span> milliseconds ago.  The last packet sent successfully to the server was <span class="number">540</span>,<span class="number">993</span> milliseconds ago.</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">at com.mysql.jdbc.Util.handleNewInstance(Util.java:<span class="number">411</span>)</span><br><span class="line">at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:<span class="number">1117</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.nextRowFast(MysqlIO.java:<span class="number">2144</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.nextRow(MysqlIO.java:<span class="number">1900</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.readSingleRowSet(MysqlIO.java:<span class="number">3390</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.getResultSet(MysqlIO.java:<span class="number">483</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.readResultsForQueryOrUpdate(MysqlIO.java:<span class="number">3096</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.readAllResults(MysqlIO.java:<span class="number">2266</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:<span class="number">2687</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:<span class="number">2719</span>)</span><br><span class="line">at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:<span class="number">2155</span>)</span><br><span class="line">at com.mysql.jdbc.PreparedStatement.execute(PreparedStatement.java:<span class="number">1379</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.preparedStatement_execute(FilterChainImpl.java:<span class="number">2931</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterEventAdapter.preparedStatement_execute(FilterEventAdapter.java:<span class="number">440</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.preparedStatement_execute(FilterChainImpl.java:<span class="number">2929</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterEventAdapter.preparedStatement_execute(FilterEventAdapter.java:<span class="number">440</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.preparedStatement_execute(FilterChainImpl.java:<span class="number">2929</span>)</span><br><span class="line">at com.alibaba.druid.proxy.jdbc.PreparedStatementProxyImpl.execute(PreparedStatementProxyImpl.java:<span class="number">118</span>)</span><br><span class="line">at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:<span class="number">493</span>)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:<span class="number">62</span>)</span><br><span class="line">at com.sun.proxy.$Proxy32.execute(Unknown Source)</span><br><span class="line">at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:<span class="number">59</span>)</span><br><span class="line">at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:<span class="number">73</span>)</span><br><span class="line">at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:<span class="number">60</span>)</span><br><span class="line">at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:<span class="number">267</span>)</span><br><span class="line">at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:<span class="number">137</span>)</span><br><span class="line">at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:<span class="number">96</span>)</span><br><span class="line">at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:<span class="number">77</span>)</span><br><span class="line">at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:<span class="number">108</span>)</span><br><span class="line">at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:<span class="number">102</span>)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:<span class="number">358</span>)</span><br><span class="line">... <span class="number">84</span> more</span><br><span class="line">Caused by: java.io.EOFException: Can not read response from server. Expected to read <span class="number">4</span> bytes, read <span class="number">0</span> bytes before connection was unexpectedly lost.</span><br><span class="line">at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:<span class="number">3017</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.nextRowFast(MysqlIO.java:<span class="number">1985</span>)</span><br><span class="line">... <span class="number">120</span> more</span><br><span class="line"><span class="number">2019</span>-<span class="number">01</span>-<span class="number">16</span> <span class="number">14</span>:<span class="number">40</span>:<span class="number">03</span>,<span class="number">649</span> ERROR [com.alibaba.druid.pool.DruidDataSource] - create connection error</span><br><span class="line">com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br><span class="line"></span><br><span class="line">The last packet sent successfully to the server was <span class="number">0</span> milliseconds ago. The driver has not received any packets from the server.</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">at com.mysql.jdbc.Util.handleNewInstance(Util.java:<span class="number">411</span>)</span><br><span class="line">at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:<span class="number">1117</span>)</span><br><span class="line">at com.mysql.jdbc.MysqlIO.&lt;init&gt;(MysqlIO.java:<span class="number">350</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.coreConnect(ConnectionImpl.java:<span class="number">2393</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:<span class="number">2430</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:<span class="number">2215</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.&lt;init&gt;(ConnectionImpl.java:<span class="number">813</span>)</span><br><span class="line">at com.mysql.jdbc.JDBC4Connection.&lt;init&gt;(JDBC4Connection.java:<span class="number">47</span>)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">at com.mysql.jdbc.Util.handleNewInstance(Util.java:<span class="number">411</span>)</span><br><span class="line">at com.mysql.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:<span class="number">399</span>)</span><br><span class="line">at com.mysql.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:<span class="number">334</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:<span class="number">148</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:<span class="number">786</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterEventAdapter.connection_connect(FilterEventAdapter.java:<span class="number">38</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:<span class="number">142</span>)</span><br><span class="line">at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:<span class="number">211</span>)</span><br><span class="line">at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:<span class="number">142</span>)</span><br><span class="line">at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:<span class="number">1360</span>)</span><br><span class="line">at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:<span class="number">1414</span>)</span><br><span class="line">at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:<span class="number">1649</span>)</span><br><span class="line">Caused by: java.net.ConnectException: <span class="function">Connection <span class="title">refused</span> <span class="params">(Connection refused)</span></span></span><br><span class="line"><span class="function">at java.net.PlainSocketImpl.<span class="title">socketConnect</span><span class="params">(Native Method)</span></span></span><br><span class="line"><span class="function">at java.net.AbstractPlainSocketImpl.<span class="title">doConnect</span><span class="params">(AbstractPlainSocketImpl.java:<span class="number">350</span>)</span></span></span><br><span class="line"><span class="function">at java.net.AbstractPlainSocketImpl.<span class="title">connectToAddress</span><span class="params">(AbstractPlainSocketImpl.java:<span class="number">206</span>)</span></span></span><br><span class="line"><span class="function">at java.net.AbstractPlainSocketImpl.<span class="title">connect</span><span class="params">(AbstractPlainSocketImpl.java:<span class="number">188</span>)</span></span></span><br><span class="line"><span class="function">at java.net.SocksSocketImpl.<span class="title">connect</span><span class="params">(SocksSocketImpl.java:<span class="number">392</span>)</span></span></span><br><span class="line"><span class="function">at java.net.Socket.<span class="title">connect</span><span class="params">(Socket.java:<span class="number">589</span>)</span></span></span><br><span class="line"><span class="function">at java.net.Socket.<span class="title">connect</span><span class="params">(Socket.java:<span class="number">538</span>)</span></span></span><br><span class="line"><span class="function">at java.net.Socket.&lt;init&gt;<span class="params">(Socket.java:<span class="number">434</span>)</span></span></span><br><span class="line"><span class="function">at java.net.Socket.&lt;init&gt;<span class="params">(Socket.java:<span class="number">244</span>)</span></span></span><br><span class="line"><span class="function">at com.mysql.jdbc.StandardSocketFactory.<span class="title">connect</span><span class="params">(StandardSocketFactory.java:<span class="number">257</span>)</span></span></span><br><span class="line"><span class="function">at com.mysql.jdbc.MysqlIO.&lt;init&gt;<span class="params">(MysqlIO.java:<span class="number">300</span>)</span></span></span><br><span class="line"><span class="function">... 21 more</span></span><br><span class="line"><span class="function">2019-01-16 14:40:03,666 ERROR [com.alibaba.druid.pool.DruidDataSource] - create connection error</span></span><br><span class="line"><span class="function">com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span></span><br></pre></td></tr></table></figure><p>æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºæ˜¯æ•°æ®åº“è¿æ¥çš„é—®é¢˜</p><hr><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><h4 id="æ•°æ®åº“å±‚é¢"><a href="#æ•°æ®åº“å±‚é¢" class="headerlink" title="æ•°æ®åº“å±‚é¢"></a>æ•°æ®åº“å±‚é¢</h4><p>æŸ¥é˜…èµ„æ–™å‘ç°æ˜¯åº”ç”¨æ‰“å¼€æ•°æ®åº“è¿æ¥åï¼Œæ“ä½œæ•°æ®åº“æ—¶ï¼Œè¿æ¥è¶…æ—¶è¢« MySQL å…³é—­äº†ï¼ŒæŸ¥çœ‹ MySQL <a href="https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_wait_timeout" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼ŒæŸ¥çœ‹è¶…æ—¶é…ç½®ï¼š</p><p><img src="https://wx1.sinaimg.cn/large/007jb4T5ly1fz8ofw8ni0j318q0mudjy.jpg" alt="image" align="center"></p><p>å¯ä»¥æ›´æ”¹ MySQL é…ç½®æ–‡ä»¶å°†æ”¹å±æ€§å€¼æ‰©å¤§ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ <code>set</code> å‘½ä»¤è€Œæ— éœ€é‡å¯æ•°æ®åº“ã€‚</p><h4 id="åº”ç”¨é…ç½®å±‚é¢"><a href="#åº”ç”¨é…ç½®å±‚é¢" class="headerlink" title="åº”ç”¨é…ç½®å±‚é¢"></a>åº”ç”¨é…ç½®å±‚é¢</h4><p>å°† <code>DruidDataSource</code> ä¸­çš„å±æ€§ <code>testOnBorrow(ç”³è¯·è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚)</code>ã€<code>testOnReturn(å½’è¿˜è¿æ¥æ—¶æ‰§è¡ŒvalidationQueryæ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼Œåšäº†è¿™ä¸ªé…ç½®ä¼šé™ä½æ€§èƒ½ã€‚)</code>æ”¹ä¸º <code>true</code>ï¼Œé‡å¯åº”ç”¨å³å¯ã€‚</p><p>å°†æ•°æ®åº“è¿æ¥ URL ååŠ ä¸Š <code>autoReconnect=true</code>ï¼Œå½“è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¿ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æŸä¸ªé¡¹ç›®å¯åŠ¨æ—¶è¶…æ…¢ï¼Œå¯åŠ¨åˆ°ä¸€åŠè¿›ç¨‹è‡ªåŠ¨åœæ‰ï¼Œæœ‰çš„æ—¶å€™ååˆ†é’Ÿæ‰èƒ½å¯åŠ¨ï¼Œé‡å¤æµ‹è¯•åå‘ç°æ˜¯æ•°æ®åº“è¿æ¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://tryme.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æµ‹è¯•ç¯å¢ƒ MySQL ç‰ˆæœ¬å‡çº§å¯¼è‡´çš„ä¸€äº›é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/mysql-upgrade-problems/"/>
    <id>https://tryme.wang/2019/01/mysql-upgrade-problems/</id>
    <published>2019-01-14T09:03:15.000Z</published>
    <updated>2019-01-14T09:05:16.659Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>æŸäº›é¡¹ç›®çš„åˆ›å»ºæ—¶é—´å­—æ®µéœ€è¦ç²¾ç¡®åˆ°<code>æ¯«ç§’</code>çº§ï¼Œè¯¥å­—æ®µç±»å‹æ˜¯ <code>timestamp</code>ï¼Œå‚è€ƒ MySQL 5.7 <a href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-types.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œ<code>0</code> åœ¨æ—¥æœŸç›¸å…³å­—æ®µä¸­çš„å«ä¹‰ä¸åŒï¼Œå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th style="text-align:center">Data Type</th><th style="text-align:center">â€œZeroâ€ Value</th></tr></thead><tbody><tr><td style="text-align:center">DATE</td><td style="text-align:center">â€œ0000-00-00â€</td></tr><tr><td style="text-align:center">TIME</td><td style="text-align:center">â€œ00:00:00â€</td></tr><tr><td style="text-align:center">DATETIME</td><td style="text-align:center">â€œ0000-00-00 00:00:00â€</td></tr><tr><td style="text-align:center">TIMESTAMP</td><td style="text-align:center">â€œ0000-00-00 00:00:00â€</td></tr><tr><td style="text-align:center">YEAR</td><td style="text-align:center">0000</td></tr></tbody></table><p>ç”±æ­¤ï¼Œå¯ä»¥çœ‹åˆ°æ— è®ºæ˜¯ <code>DATETIME</code> è¿˜æ˜¯ <code>TIMESTAMP</code> å­—æ®µå±æ€§ï¼Œé»˜è®¤éƒ½æ˜¯ç²¾ç¡®åˆ°ç§’çš„ã€‚</p><p>æŸ¥é˜…èµ„æ–™å‘ç°ï¼Œå¯ä»¥é€šè¿‡ <code>TIMESTAMP(n)</code> æ¥æŒ‡å®šç²¾ç¡®åº¦ï¼Œå®é™…ä¿®æ”¹ä¸­å‘ç°å½“å‰æ•°æ®åº“ç‰ˆæœ¬æ˜¯ <code>5.5</code>ï¼Œæ‰§è¡Œå­—æ®µç±»å‹æ›´æ”¹æ—¶ä¸€ç›´æŠ¥é”™ï¼Œä½†æ˜¯åœ¨ <code>5.7</code> ç‰ˆæœ¬ä¸­å¯ä»¥æ­£å¸¸ä¿®æ”¹å­—æ®µç±»å‹ï¼Œåå°†æ•°æ®åº“æ›´æ–°åˆ° <code>5.7</code> ç‰ˆæœ¬ï¼Œemmâ€¦ï¼Œè¿æ¥å‡çº§çš„åŒæ—¶ï¼Œå°é—®é¢˜ä¹Ÿæ˜¯ä¸å°‘ã€‚</p><hr><h3 id="é—®é¢˜åŠè§£å†³"><a href="#é—®é¢˜åŠè§£å†³" class="headerlink" title="é—®é¢˜åŠè§£å†³"></a>é—®é¢˜åŠè§£å†³</h3><h4 id="mysql-user-è¡¨ç»“æ„çš„æ”¹å˜"><a href="#mysql-user-è¡¨ç»“æ„çš„æ”¹å˜" class="headerlink" title="mysql.user è¡¨ç»“æ„çš„æ”¹å˜"></a>mysql.user è¡¨ç»“æ„çš„æ”¹å˜</h4><p><code>5.5</code> å’Œ <code>5.7</code> ç‰ˆæœ¬çš„ <code>mysql.user</code> è¡¨ç»“æ„ä¸åŒï¼ˆæš‚ä¸ä»”ç»†æ¢è®¨ï¼‰ï¼Œå¯¼è‡´é¡¹ç›®ä¸­éœ€è¦è¿æ¥ MySQL æ•°æ®åº“çš„åœ°æ–¹å…¨éƒ¨è®¤è¯å¤±è´¥ <code>Access denied for test@192.168.53.6</code>ï¼Œä½†æ˜¯ï¼Œè¯¥è¡¨ä¸­çš„æ•°æ®å…¨éƒ¨æ­£å¸¸ï¼Œå†…ç½‘å…¨éƒ¨å¯è¿æ¥ï¼Œå°è¯•é‡ç½®å¯†ç ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span> <span class="keyword">for</span> <span class="string">'test@192.168.%.%'</span> = <span class="keyword">password</span>(<span class="string">'test666'</span>);</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæŠ¥é”™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1805 (HY000): Column count of mysql.user is wrong. </span><br><span class="line">Expected 42, found 49. The table is probably corrupted</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢èµ„æ–™å‘ç°ï¼Œæ˜¯æ•°æ®åº“å‡çº§å¯¼è‡´çš„ï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„è¡¨ç»“æ„ä¸åŒï¼Œåªå¥½æ‰§è¡Œå‡çº§å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_upgrade -u root -p</span><br></pre></td></tr></table></figure><p>è¾“å…¥ <code>root</code> å¯†ç ç­‰å¾…æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ›´æ”¹å¯†ç ï¼ŒSQL è¯­å¥æ‰§è¡ŒæˆåŠŸï¼Œå†åˆ·æ–°æƒé™å³å¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure><h4 id="GROUP-BY-é—®é¢˜"><a href="#GROUP-BY-é—®é¢˜" class="headerlink" title="GROUP BY é—®é¢˜"></a>GROUP BY é—®é¢˜</h4><p>æ—¥å¿—æŠ¥é”™ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'test.user.id' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯ <code>sql_mode=only_full_group_by</code> çš„é—®é¢˜ï¼ŒæŸ¥çœ‹<a href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_only_full_group_by" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå‘ç°é»˜è®¤çš„ <code>sql_mode</code> ä¸­æœ‰ <code>only_full_group_by</code>ï¼Œè¯¥é…ç½®å¯¼è‡´ <code>GROUP BY</code> åçš„åˆ—å¿…é¡»åœ¨ <code>SELECT</code> çš„åˆ—ä¸­ã€‚</p><p>æ‰§è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@sql_mode;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å½“å‰ <code>sql_mode</code>ï¼Œå°† <code>only_full_group_by</code> åˆ é™¤å³å¯ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;åŸå› &quot;&gt;&lt;a href=&quot;#åŸå› &quot; class=&quot;headerlink&quot; title=&quot;åŸå› &quot;&gt;&lt;/a&gt;åŸå› &lt;/h3&gt;&lt;p&gt;æŸäº›é¡¹ç›®çš„åˆ›å»ºæ—¶é—´å­—æ®µéœ€è¦ç²¾ç¡®åˆ°&lt;code&gt;æ¯«ç§’&lt;/code&gt;çº§ï¼Œè¯¥å­—æ®µç±»å‹æ˜¯ &lt;code&gt;timestamp&lt;/code&gt;ï¼Œå‚è€ƒ MySQ
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://tryme.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Thymeleaf çš„ç¼“å­˜å¯¼è‡´çƒ­éƒ¨ç½²çš„é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/idea-hotswap-thymeleaf-cache/"/>
    <id>https://tryme.wang/2019/01/idea-hotswap-thymeleaf-cache/</id>
    <published>2019-01-12T08:55:00.000Z</published>
    <updated>2019-01-12T09:10:55.514Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨ IDEA çƒ­éƒ¨ç½²é¡¹ç›®æ—¶ï¼Œä¹‹å‰çš„é¡¹ç›®é…ç½®å®Œæˆåï¼Œé¡µé¢æ–‡ä»¶æ”¹åŠ¨æˆ–è€… Java æ–‡ä»¶æ”¹åŠ¨éƒ½èƒ½å³æ—¶çƒ­éƒ¨ç½²ï¼Œä½†æ˜¯åœ¨å…¬å¸ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œçƒ­éƒ¨ç½²çªç„¶å¤±æ•ˆï¼ŒæŠ˜è…¾äº†åŠå¤©ğŸ˜­ã€‚</p></blockquote><h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>å› ä¸ºè¦æ¥æ‰‹ä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨éƒ¨ç½²è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°é¡µé¢çš„çƒ­éƒ¨ç½²åœ¨ IDEA ä¸­ä¸å¥½ç”¨ï¼Œå½“é¡µé¢ä¸­çš„ä»£ç æ›´æ”¹æ—¶ï¼Œæ— è®ºæ˜¯ IDEA æ‰‹åŠ¨ update è¿˜æ˜¯å¤±å»ç„¦ç‚¹ï¼Œè™½ç„¶å‡ºå‘äº†çƒ­éƒ¨ç½²ï¼Œä½†æ˜¯é¡µé¢æ–‡ä»¶åˆ†æ˜æœ‰äº†æ”¹åŠ¨ï¼Œä½†æ˜¯æ€»æ˜¯æç¤º <code>Loaded classes are up to date.Nothing to reload</code>ï¼Œå¾ˆæ˜¯å¥‡æ€ªğŸ¤”ï¼Œåæ¥æ”¹åŠ¨ Java æ–‡ä»¶ï¼Œçƒ­éƒ¨ç½²æ²¡é—®é¢˜ï¼ŒçœŸæ˜¯å“”äº†ğŸ¶äº†ã€‚</p><hr><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>å¼€å§‹ä»¥ä¸ºæ˜¯è‡ªå·±é…ç½®é…ç½®çš„é—®é¢˜ï¼Œå¯ä¹‹å‰çš„é¡¹ç›®ä¹Ÿæ˜¯è¿™ä¹ˆé…ç½®çš„ï¼Œæœ‰é—®é¢˜æ—©å°±æš´éœ²å‡ºæ¥äº†ï¼Œä¸åº”è¯¥æ˜¯é…ç½®çš„é—®é¢˜ã€‚</p><p>åœ¨ <code>Dont&#39;t be evil --- Google</code> çš„ç½‘ç«™ä¸Šé¨æ¸¸äº†ä¸€ç•ªï¼Œæ‰¾äº†å¥½å¤šç­”æ¡ˆéƒ½ä¸æ˜¯æƒ³è¦çš„ï¼Œç»ˆäºåœ¨ä¸‹ç­å‰å¤•è¢«æˆ‘æ‰¾åˆ°äº†ğŸ˜ï¼Œç­”æ¡ˆåœ¨<a href="https://stackoverflow.com/questions/50395971/unable-to-hotswap-html-file-in-intellij-with-tomcat-9" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p><img src="https://ws1.sinaimg.cn/large/007jb4T5ly1fz3wesnr3xj311q0ea422.jpg" alt="image" align="center"></p><p>åŸæ¥æ˜¯ <code>Thymeleaf</code> çš„ç¼“å­˜ğŸ˜‚ï¼Œèµ¶ç´§å»æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå‘ç°äº† <code>Thymeleaf</code> çš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"templateResolver"</span> <span class="attr">class</span>=<span class="string">"org.thymeleaf.templateresolver.ServletContextTemplateResolver"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheable"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheTTLMs"</span> <span class="attr">value</span>=<span class="string">"#&#123;60*60*1000&#125;"</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>éƒ½æ˜¯è¿™ä¸ª <code>cacheable</code> çš„é”…ï¼Œæ”¹ä¸º <code>false</code> ï¼Œé‡å¯åä¸€åˆ‡æ­£å¸¸ï¼Œåˆèƒ½æ„‰å¿«çš„ç©è€äº†ğŸ˜Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨ IDEA çƒ­éƒ¨ç½²é¡¹ç›®æ—¶ï¼Œä¹‹å‰çš„é¡¹ç›®é…ç½®å®Œæˆåï¼Œé¡µé¢æ–‡ä»¶æ”¹åŠ¨æˆ–è€… Java æ–‡ä»¶æ”¹åŠ¨éƒ½èƒ½å³æ—¶çƒ­éƒ¨ç½²ï¼Œä½†æ˜¯åœ¨å…¬å¸ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œçƒ­éƒ¨ç½²çªç„¶å¤±æ•ˆï¼ŒæŠ˜è…¾äº†åŠå¤©ğŸ˜­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; 
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="IDEA" scheme="https://tryme.wang/tags/IDEA/"/>
    
      <category term="Thymeleaf" scheme="https://tryme.wang/tags/Thymeleaf/"/>
    
  </entry>
  
  <entry>
    <title>MySQL äº‹åŠ¡æ•è·å¼‚å¸¸åæ— æ³•å›æ»š</title>
    <link href="https://tryme.wang/2019/01/transaction-not-rollback/"/>
    <id>https://tryme.wang/2019/01/transaction-not-rollback/</id>
    <published>2019-01-08T11:25:00.000Z</published>
    <updated>2019-01-12T09:11:53.847Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å½“å‰é…ç½®"><a href="#å½“å‰é…ç½®" class="headerlink" title="å½“å‰é…ç½®"></a>å½“å‰é…ç½®</h3><p>ç”±äºé¡¹ç›®æ˜¯ SSM æ¡†æ¶æ•´åˆè€Œæˆï¼ŒMySQL çš„äº‹åŠ¡é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ•°æ®æºé…ç½®--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span></span></span><br><span class="line"><span class="tag"><span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc_url&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc_username&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc_password&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--äº‹åŠ¡ç®¡ç†é…ç½®--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--åˆ‡é¢é…ç½®--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--AOP é…ç½®--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æŠŠäº‹åŠ¡æ§åˆ¶åœ¨ Service å±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"allServiceMethod"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">expression</span>=<span class="string">"execution(* com.test.*.service..*.*(..))"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"allServiceMethod"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯æ³¨è§£æ–¹å¼é…ç½®äº‹ç‰© --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure><hr><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><p>åœ¨ä¸€ä¸ªäº‹åŠ¡ç®¡ç†çš„æ¥å£ï¼Œæ–¹æ³•æŠ›å‡ºäº† <code>NullPointerException</code> å¼‚å¸¸ï¼Œä½†æ˜¯æœ‰å…³æ•°æ®åº“è¡¨çš„æ“ä½œå´æ²¡æœ‰å›æ»šï¼Œä¼ªä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   noticeMapper.insert(notice);</span><br><span class="line">   noticeLogMapper.insert(noticeLog);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    LOGGER.error(<span class="string">"æ•°æ®æ’å…¥å¼‚å¸¸ï¼ï¼ï¼"</span>);</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åœ¨ <code>noticeLog</code> çš„æ’å…¥è¿‡ç¨‹ä¸­ä»£ç æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯ <code>notice</code> å´æˆåŠŸçš„æ’å…¥åˆ°äº†æ•°æ®åº“ï¼Œç›¸å½“äºè¿™ä¸ªæ˜æ˜è¢«äº‹åŠ¡ç®¡ç†çš„æ–¹æ³•åœ¨é‡åˆ°ç¨‹åºå¼‚å¸¸å´æ²¡æœ‰å›æ»šäº‹åŠ¡ğŸ¤”ã€‚ </p><p>æŸ¥é˜…æ–‡æ¡£åŠèµ„æ–™ï¼Œåœ¨ Spring <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/data-access.html#transaction-declarative-rolling-back" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ä¸­æœ‰è§£é‡Šï¼š</p><p><img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fz3v3a1rpej31gw10ealk.jpg" alt="image" align="center"></p><p>æ³¨æ„ä¸­é—´çº¢æ¡†æ®µè½ï¼Œç¿»è¯‘ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In its default configuration, the Spring Frameworkâ€™s transaction infrastructure code marks a transaction for rollback only in the case of runtime, unchecked exceptions. That is, when the thrown exception is an instance or subclass of RuntimeException. ( Error instances also, by default, result in a rollback). Checked exceptions that are thrown from a transactional method do not result in rollback in the default configuration. </span><br><span class="line"></span><br><span class="line">åœ¨å…¶é»˜è®¤é…ç½®ä¸­ï¼ŒSpring Frameworkçš„äº‹åŠ¡åŸºç¡€ç»“æ„ä»£ç ä»…åœ¨è¿è¡Œæ—¶æœªç»æ£€æŸ¥çš„å¼‚å¸¸æƒ…å†µä¸‹æ ‡è®°å›æ»šäº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸æ˜¯RuntimeExceptionçš„å®ä¾‹æˆ–å­ç±»ã€‚ ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯å®ä¾‹ä¹Ÿä¼šå¯¼è‡´å›æ»šï¼‰ã€‚ä»äº‹åŠ¡æ–¹æ³•æŠ›å‡ºçš„å·²æ£€æŸ¥å¼‚å¸¸ä¸ä¼šå¯¼è‡´åœ¨é»˜è®¤é…ç½®ä¸­å›æ»šã€‚</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»£ç æŠ›å‡º RuntimeException çš„å®ä¾‹ã€å­ç±»æˆ–åœ¨é»˜è®¤æƒ…å†µä¸‹çš„ Error æ‰ä¼šå¯¼è‡´å›æ»šï¼Œ<code>ä½†æ˜¯ï¼Œä»äº‹åŠ¡æ–¹æ³•æŠ›å‡ºçš„å·²æ£€æŸ¥å¼‚å¸¸ä¸ä¼šå¯¼è‡´åœ¨é»˜è®¤é…ç½®ä¸­å›æ»šã€‚</code></p><p>æ‰€ä»¥ä»£ç ä¸­ <code>try catch</code> æ•è·äº†å¼‚å¸¸ï¼Œå¯¼è‡´äº†äº‹åŠ¡æ— æ³•å›æ»š(âŠ™xâŠ™)ã€‚</p><hr><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><p>æ—¢ç„¶ä»£ç çš„å¼‚å¸¸è¢«æ•è·åäº‹åŠ¡æ— æ³•å›æ»šï¼Œé‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨æŠ›å‡º <code>RuntimeException</code> çš„å®ä¾‹æˆ–å­ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   noticeMapper.insert(notice);</span><br><span class="line">   noticeLogMapper.insert(noticeLog);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    LOGGER.error(<span class="string">"æ•°æ®æ’å…¥å¼‚å¸¸ï¼ï¼ï¼"</span>);</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>æ—¢ç„¶äº‹åŠ¡æ²¡æœ‰è‡ªåŠ¨å›æ»šï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®äº‹åŠ¡çš„å›æ»šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   noticeMapper.insert(notice);</span><br><span class="line">   noticeLogMapper.insert(noticeLog);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    LOGGER.error(<span class="string">"æ•°æ®æ’å…¥å¼‚å¸¸ï¼ï¼ï¼"</span>);</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å†æ¬¡è°ƒè¯•è¿è¡Œåï¼Œäº‹åŠ¡æ­£å¸¸å›æ»šğŸ˜Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å½“å‰é…ç½®&quot;&gt;&lt;a href=&quot;#å½“å‰é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;å½“å‰é…ç½®&quot;&gt;&lt;/a&gt;å½“å‰é…ç½®&lt;/h3&gt;&lt;p&gt;ç”±äºé¡¹ç›®æ˜¯ SSM æ¡†æ¶æ•´åˆè€Œæˆï¼ŒMySQL çš„äº‹åŠ¡é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight x
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://tryme.wang/tags/MySQL/"/>
    
      <category term="Spring" scheme="https://tryme.wang/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>å¤§ç‰ˆæœ¬æ›´æ–°ä¸Šçº¿é—®é¢˜æ±‡æ€»</title>
    <link href="https://tryme.wang/2019/01/new-version-problems/"/>
    <id>https://tryme.wang/2019/01/new-version-problems/</id>
    <published>2019-01-03T17:15:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Tomcat-å®¹å™¨å¯åŠ¨é—®é¢˜"><a href="#Tomcat-å®¹å™¨å¯åŠ¨é—®é¢˜" class="headerlink" title="Tomcat å®¹å™¨å¯åŠ¨é—®é¢˜"></a>Tomcat å®¹å™¨å¯åŠ¨é—®é¢˜</h3><blockquote><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><ol><li>Spring Boot ç‰ˆæœ¬ 2.0.3.RELEASE</li><li>druid-spring-boot-starter ç‰ˆæœ¬ 1.1.9</li><li>mysql-connector-java ç‰ˆæœ¬ 5.1.46</li><li>MySQL æ•°æ®åº“ç‰ˆæœ¬ 5.7</li><li>Tomcat ç‰ˆæœ¬ 7.0.67ï¼ˆæœ€ç»ˆå‡çº§äº†ç‰ˆæœ¬åˆ° Tomcat 8ï¼‰</li><li>JDK ç‰ˆæœ¬ 1.7ï¼ˆæœ€ç»ˆå‡çº§åˆ°1.8ï¼‰</li></ol></blockquote><hr><p><strong>é—®é¢˜ï¼š</strong> æµ‹è¯•ã€ç”Ÿäº§é…ç½®æ–‡ä»¶å±æ€§ä¸åŒæ­¥ï¼Œç”Ÿäº§ç¯å¢ƒå¾ˆå¤šå±æ€§æœªé…ç½®ï¼Œå¯¼è‡´é”™è¯¯æ³¨å…¥ã€‚<br><strong>è§£å†³ï¼š</strong> å°†æ‰€æœ‰æ³¨å…¥çš„ API åœ°å€åŒæ­¥ã€‚</p><hr><p><strong>é—®é¢˜ï¼š</strong> å¯åŠ¨æ—¶ Dubbo æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°æœåŠ¡ã€‚</p><p><strong>è§£å†³ï¼š</strong> æä¾›è€…æ‰€åœ¨æœºå™¨ Dubbo ç«¯å£æœªå¼€æ”¾ï¼Œå¼€æ”¾å¯¹åº”ç«¯å£å³å¯ã€‚</p><hr><p><strong>é—®é¢˜ï¼š</strong> Tomcat æ— æ³•å¯åŠ¨ï¼Œæ¯æ¬¡å¯åŠ¨æŠ¥ä¸åŒçš„é”™è¯¯ã€‚</p><p><strong>è§£å†³ï¼š</strong> JDKç‰ˆæœ¬å‡çº§åˆ° 1.8â†’Tomcat ç‰ˆæœ¬å‡çº§åˆ° 7.0.92</p><hr><p><strong>é—®é¢˜ï¼š</strong> java.lang.NoClassDefFoundError: javax/el/ELManager</p><p><strong>è§£å†³ï¼š</strong><a href="https://tryme.wang/archives/201811/springboot-war-problem.html">å‚è€ƒ</a></p><hr><p><strong>é—®é¢˜ï¼š</strong></p><p>é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySQLæ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    druid:</span></span><br><span class="line"><span class="attr">      url:</span> <span class="string">jdbc\:mysql\://rds.xxx.com\:3306/xxx?useUnicode\=true&amp;characterEncoding\=UTF-8&amp;zeroDateTimeBehavior\=convertToNull</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure><p>å¼‚å¸¸ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.sql.SQLException: connect error, url jdbc\:mysql\:<span class="comment">//rds.xxx.com\:3306/xxx?useUnicode\=true&amp;characterEncoding\=UTF-8&amp;zeroDateTimeBehavior\=convertToNull, driverClass com.mysql.jdbc.Driver</span></span><br><span class="line">at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:<span class="number">1582</span>)</span><br><span class="line">at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:<span class="number">859</span>)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:<span class="number">1833</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:<span class="number">1776</span>)</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:<span class="number">1704</span>)</span><br><span class="line">... <span class="number">116</span> more</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> å¼‚å¸¸ä¿¡æ¯é‡Œéå¸¸æ˜ç¡®çš„æåŠæ˜¯æ•°æ®åº“è¿æ¥ url çš„é—®é¢˜ï¼Œåœ¨ Spring Boot  çš„ yml é…ç½®æ–‡ä»¶ä¸­ï¼Œæ ¼å¼ä¸ºï¼š<code>property: value</code> å±æ€§åç§°åŠ ã€Œ:ã€ä¹‹åæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œé¡¹ç›®ä¹‹å‰çš„é…ç½®æ–‡ä»¶ä¸­ MySQL æ•°æ®åº“çš„è¿æ¥åœ°å€è½¬ä¹‰è¿‡ï¼Œè¿™é‡Œç›´æ¥å¤åˆ¶è¿‡æ¥ä½¿ç”¨ï¼Œæ˜¯è¡Œä¸é€šçš„ï¼Œå°†è½¬ä¹‰å­—ç¬¦ã€Œ\ã€å»æ‰å³å¯ã€‚</p><hr><h3 id="Tomcat-é‡å¯ä¹‹åå¼‚å¸¸"><a href="#Tomcat-é‡å¯ä¹‹åå¼‚å¸¸" class="headerlink" title="Tomcat é‡å¯ä¹‹åå¼‚å¸¸"></a>Tomcat é‡å¯ä¹‹åå¼‚å¸¸</h3><p><strong>é—®é¢˜ï¼š</strong></p><p>å¼‚å¸¸ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">org.apache.catalina.session.StandardManager doLoad</span><br><span class="line">SEVERE: IOException <span class="keyword">while</span> loading persisted sessions: java.io.EOFException</span><br><span class="line">java.io.EOFException</span><br><span class="line">    at java.io.ObjectInputStream$PeekInputStream.readFully(ObjectInputStream.java:<span class="number">2298</span>)</span><br><span class="line">    at java.io.ObjectInputStream$BlockDataInputStream.readShort(ObjectInputStream.java:<span class="number">2767</span>)</span><br><span class="line">    at java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:<span class="number">798</span>)</span><br><span class="line">    at java.io.ObjectInputStream.&lt;init&gt;(ObjectInputStream.java:<span class="number">298</span>)</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">org.apache.catalina.session.StandardManager startInternal</span><br><span class="line">SEVERE: Exception loading sessions from persistent storage</span><br><span class="line">java.io.EOFException</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> åˆ é™¤ <code> ${catalina.home}/work/Catalina/localhost/${APP-NAME}/SESSION.ser</code> å³å¯</p><hr><p><strong>é—®é¢˜ï¼š</strong> Dubbo æŠ¥é”™</p><p>æŠ¥é”™ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>-<span class="number">12</span>-<span class="number">15</span> <span class="number">20</span>:<span class="number">26</span>:<span class="number">52</span>,<span class="number">387</span> [DubboSaveRegistryCache-thread-<span class="number">1</span>] WARN  [com.alibaba.dubbo.registry.zookeeper.ZookeeperRegistry] -  [DUBBO] Failed to save registry store file, cause: Can not lock the registry cache file /root/.dubbo/dubbo-registry-<span class="number">10.11</span>.12.13.cache, ignore and retry later, maybe multi java process use the file, please config: dubbo.registry.file=xxx.properties, dubbo version: <span class="number">2.5</span>.3, current host: <span class="number">10.20</span>.30.40</span><br><span class="line">java.io.IOException: Can not lock the registry cache file /root/.dubbo/dubbo-registry-<span class="number">10.11</span>.12.13.cache, ignore and retry later, maybe multi java process use the file, please config: dubbo.registry.file=xxx.properties</span><br><span class="line">        at com.alibaba.dubbo.registry.support.AbstractRegistry.doSaveProperties(AbstractRegistry.java:<span class="number">193</span>)</span><br><span class="line">        at com.alibaba.dubbo.registry.support.AbstractRegistry$SaveProperties.run(AbstractRegistry.java:<span class="number">150</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1145</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">615</span>)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</span><br></pre></td></tr></table></figure><p>Dubbo ä¼šä½¿ç”¨æ–‡ä»¶ç¼“å­˜æ³¨å†Œä¸­å¿ƒåœ°å€åˆ—è¡¨åŠæœåŠ¡æä¾›è€…åˆ—è¡¨ï¼Œé»˜è®¤è·¯å¾„åœ¨ <code>/${user.home}/.dubbo/dubbo-registry-10.20.30.40.cache</code>ï¼Œåº”ç”¨é‡å¯æ—¶å°†åŸºäºæ­¤æ–‡ä»¶æ¢å¤ï¼Œä¸€å°æœåŠ¡å™¨æœ‰å¤šä¸ªåº”ç”¨ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¢å¤æ—¶ï¼Œä¼šå‡ºç°è¿™ä¸ªè­¦å‘Šã€‚</p><p><strong>è§£å†³ï¼š</strong> å¯ä»¥åœ¨æ¯ä¸ªé¡¹ç›® Dubbo é…ç½®æ–‡ä»¶ä¸­çš„ <code><a href="dubbo:registry" target="_blank" rel="noopener">dubbo:registry</a></code> æ ‡ç­¾ä¸­çš„ file æŒ‡å®šä¸åŒçš„æ–‡ä»¶è·¯å¾„ã€‚ <a href="http://dubbo.apache.org/zh-cn/docs/user/references/xml/dubbo-registry.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a> <a href="https://github.com/apache/incubator-dubbo/issues/81" target="_blank" rel="noopener">å‚è€ƒåœ°å€</a></p><hr><p><strong>é—®é¢˜ï¼š</strong> Tomcat å®¹å™¨æ— æ—¥å¿—è¾“å‡º<br>logback-spring.xmlé…ç½®ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">&lt;!-- æµ‹è¯•ç¯å¢ƒ+å¼€å‘ç¯å¢ƒ. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"test,dev"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.xxx.im"</span> <span class="attr">level</span>=<span class="string">"INFO"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"prod"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.xxx.im"</span> <span class="attr">level</span>=<span class="string">"ERROR"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p><strong>è§£å†³ï¼š</strong> ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¾“å‡ºçº§åˆ«è¿‡é«˜ï¼Œ<code>INFO</code> çº§åˆ«çš„æ— æ³•è¾“å‡ºï¼Œå°†  <code>ERROR</code> æ”¹ä¸º <code>INFO</code> å³å¯ã€‚</p><hr><blockquote><p>è½¬æˆ˜åä¸ºäº‘ä¹‹åğŸ™‚</p></blockquote><h3 id="RabbitMQ-è¿æ¥"><a href="#RabbitMQ-è¿æ¥" class="headerlink" title="RabbitMQ è¿æ¥"></a>RabbitMQ è¿æ¥</h3><blockquote><p>Spring Boot ç‰ˆæœ¬ <code>2.0.3.RELEASE</code></p></blockquote><p><strong>é—®é¢˜ï¼š</strong> RabbitMQ ç›´æ¥ä½¿ç”¨ yaml é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">rabbitmq:</span></span><br><span class="line"><span class="attr">    host:</span> <span class="string">rabbitmq.xxx.com</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">user</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">password123456</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">5672</span></span><br></pre></td></tr></table></figure><p> é¡¹ç›®å¯åŠ¨æ—¶æŠ¥é”™ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    ...ForgivingExceptionHandler - <span class="function">An unexpected connection driver error <span class="title">occured</span> <span class="params">(Exception message: Connection closed)</span></span></span><br><span class="line"><span class="function">...</span></span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> ä»å¼‚å¸¸æ—¥å¿—ä¸­å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°ï¼Œæ˜¯ <code>Connection closed</code>ï¼Œè§£å†³æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>åˆæ­¥åˆ¤æ–­å½“å‰æœºå™¨æ— æ³•è¿é€š RabbitMQ æ‰€åœ¨æœºå™¨ï¼Œä½¿ç”¨  <code>ping rabbitmq.xxx.com</code> å‘½ä»¤å¯ä»¥ ping é€š RabbitMQ æ‰€åœ¨æœºå™¨ï¼Œå¹¶ä¸”  <code>telnet rabbitmq.xxx.com 5672</code> ä¹Ÿæ˜¯å¯ä»¥è¿é€šçš„ï¼Œæ’é™¤æ­¤åŸå› ï¼›</p></li><li><p>ç¡®è®¤ <code>usernameã€password</code> å‡†ç¡®æ€§ï¼Œå‘ç° RabbitMQ æ˜¯æ–°è£…çš„ï¼Œä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å…¶ç”¨æˆ·ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@rabbit ~]<span class="comment"># rabbitmqctl list_users</span></span><br><span class="line">Listing users ...</span><br><span class="line">admin   [administrator]</span><br></pre></td></tr></table></figure><p>å‘ç°å¹¶æ²¡æœ‰ <code>user</code> è¿™ä¸ªç”¨æˆ·ï¼Œåˆ›å»ºç”¨æˆ·ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rabbit ~]<span class="comment"># rabbitmqctl add_user user password123456</span></span><br><span class="line">Creating user <span class="string">"user"</span> ...</span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸ºç®¡ç†å‘˜ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@rabbit ~]<span class="comment"># rabbitmqctl set_user_tags user administrator</span></span><br><span class="line">Setting tags <span class="keyword">for</span> user <span class="string">"user"</span> to [administrator] ...</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œä½¿ç”¨è¯¥ç”¨æˆ·ç™»å½• RabbitMQ WEB ç«¯ç®¡ç†é¡µé¢åæŸ¥çœ‹è¯¥ç”¨æˆ·ä¿¡æ¯ï¼š<br><img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fyfu2m6sjbj315w0vmgou.jpg" alt="image" align="center"><br>ç‚¹å‡» <code>Set permission</code> é…ç½®æƒé™ï¼Œé‡å¯é¡¹ç›®åé—®é¢˜è§£å†³ã€‚</p></li></ol><hr><h3 id="Tomcat-é—®é¢˜"><a href="#Tomcat-é—®é¢˜" class="headerlink" title="Tomcat é—®é¢˜"></a>Tomcat é—®é¢˜</h3><p><strong>é—®é¢˜ï¼š</strong> å¯åŠ¨ Tomcat å®¹å™¨æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jni.Error: <span class="number">70023</span>: This function has not been implemented on <span class="keyword">this</span> platform</span><br><span class="line">        at org.apache.tomcat.jni.SSL.initialize(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> ä¿®æ”¹ <code>$TOMCAT_HOME/conf/server.xml</code> ä¸­çš„ <code>&lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;off&quot; /&gt;</code> å³å¯è§£å†³ã€‚</p><h3 id="Tomcat-é—®é¢˜-1"><a href="#Tomcat-é—®é¢˜-1" class="headerlink" title="Tomcat é—®é¢˜"></a>Tomcat é—®é¢˜</h3><p><strong>é—®é¢˜ï¼š</strong> å¯åŠ¨ Tomcat å®¹å™¨æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jni.Error: <span class="number">70023</span>: This function has not been implemented on <span class="keyword">this</span> platform</span><br><span class="line">        at org.apache.tomcat.jni.SSL.initialize(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> ä¿®æ”¹ <code>$TOMCAT_HOME/conf/server.xml</code> ä¸­çš„ <code>&lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;off&quot; /&gt;</code> å³å¯è§£å†³ã€‚</p><h3 id="çº¿ä¸Šé—®é¢˜å¤„ç†"><a href="#çº¿ä¸Šé—®é¢˜å¤„ç†" class="headerlink" title="çº¿ä¸Šé—®é¢˜å¤„ç†"></a>çº¿ä¸Šé—®é¢˜å¤„ç†</h3><p><strong>é—®é¢˜ï¼š</strong> </p><blockquote><p>MongoDB ç‰ˆæœ¬ï¼šTokuMX 2.0.2 | MongoDB 2.4</p><p>spring-data-mongodb ç‰ˆæœ¬ï¼š1.4.1.RELEASE</p><p>spring-data-commons ç‰ˆæœ¬ï¼š1.7.2.RELEASE</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: You have to provide at least one property to sort by!</span><br><span class="line">        at org.springframework.data.domain.Sort.&lt;init&gt;(Sort.java:<span class="number">91</span>)</span><br><span class="line">        at org.springframework.data.domain.Sort.&lt;init&gt;(Sort.java:<span class="number">79</span>)</span><br><span class="line">    ...</span><br><span class="line">        at sun.reflect.GeneratedMethodAccessor415.invoke(Unknown Source)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">606</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> å¼‚å¸¸ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œæœªæä¾›æ’åºçš„å±æ€§ï¼Œæ£€æŸ¥ä»£ç ï¼Œå¼‚å¸¸ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line">...</span><br><span class="line">   Query query = <span class="keyword">new</span> Query();</span><br><span class="line">List&lt;String&gt; sortStrList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (...) &#123;</span><br><span class="line">   sortStrList.add(<span class="string">"property"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">query.with(<span class="keyword">new</span> Sort(Sort.Direction.DESC, sortStrList.toArray(<span class="keyword">new</span> String[sortStrList.size()])))</span><br><span class="line">   mongoTemplate.find(query, Xxx.class);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œæ’åºå±æ€§é›†åˆ <code>sortStrList</code> ä¸­æœ‰å¯èƒ½æ²¡æœ‰ä»»ä½•å±æ€§ï¼Œå†æŸ¥çœ‹ <code>org.springframework.data.domain.Sort</code> ä¸­çš„æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">(Sort.Direction direction, String... properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(direction, (List)(properties == <span class="keyword">null</span> ? <span class="keyword">new</span> ArrayList() : Arrays.asList(properties)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">(Sort.Direction direction, List&lt;String&gt; properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (properties != <span class="keyword">null</span> &amp;&amp; !properties.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.orders = <span class="keyword">new</span> ArrayList(properties.size());</span><br><span class="line">        Iterator i$ = properties.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(i$.hasNext()) &#123;</span><br><span class="line">            String property = (String)i$.next();</span><br><span class="line">            <span class="keyword">this</span>.orders.add(<span class="keyword">new</span> Sort.Order(direction, property));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"You have to provide at least one property to sort by!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>sortStrList</code> å®Œå…¨æ— éœ€è½¬æ¢ä¸ºæ•°ç»„ï¼Œä½†è¿™ä¸æ˜¯ä¸»è¦åŸå› ï¼Œä»ä¸‹é¢çš„æ„é€ æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¼ å…¥çš„ List é›†åˆä¸å¯ä¸ºç©ºå¯¹è±¡å¹¶ä¸”å¿…é¡»é›†åˆå¤§å°å¿…é¡»å¤§äº 0ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆå¯ä»¥æœ‰å¤šç§ï¼Œåªéœ€æ§åˆ¶ <code>sortStrList</code> é›†åˆä¸ä¸ºç©ºä¸” size å¤§äº 0ï¼Œæˆ–è€…æ ¹æ®åˆ¤æ–­æŸ¥è¯¢ä¸åŠ æ’åºæ¡ä»¶ä¹Ÿå¯ä»¥è§£å†³ã€‚</p><hr><p><strong>é—®é¢˜ï¼š</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.data.mongodb.UncategorizedMongoDbException: Lock not granted. Try restarting the transaction.; nested exception is com.mongodb.MongoExcep</span><br><span class="line">tion: Lock not granted. Try restarting the transaction.</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoExceptionTranslator.translateExceptionIfPossible(MongoExceptionTranslator.java:<span class="number">83</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.potentiallyConvertRuntimeException(MongoTemplate.java:<span class="number">1828</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.execute(MongoTemplate.java:<span class="number">409</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.doUpdate(MongoTemplate.java:<span class="number">995</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.updateFirst(MongoTemplate.java:<span class="number">969</span>)</span><br><span class="line">        ...</span><br><span class="line">        at sun.reflect.GeneratedMethodAccessor378.invoke(Unknown Source)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">606</span>)</span><br><span class="line">        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:<span class="number">317</span>)</span><br><span class="line">        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:<span class="number">183</span>)</span><br><span class="line">        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:<span class="number">150</span>)</span><br><span class="line">        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:<span class="number">80</span>)</span><br><span class="line">        ...</span><br><span class="line">        at sun.reflect.GeneratedMethodAccessor200.invoke(Unknown Source)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">606</span>)</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> æ‰‹åŠ¨é…ç½®çš„ MongoDB äº‹åŠ¡é—®é¢˜ï¼Œå°šæœªå½»åº•è§£å†³ã€‚</p><hr><p><strong>é—®é¢˜ï¼š</strong> </p><blockquote><p>Spring æ•´åˆ MongoDBé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mongoOptions"</span> <span class="attr">class</span>=<span class="string">"com.mongodb.MongoOptions"</span>&gt;</span></span><br><span class="line">&gt; ...</span><br><span class="line">&gt; <span class="comment">&lt;!-- è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)ï¼Œé»˜è®¤ä¸º4000 --&gt;</span></span><br><span class="line">&gt; <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectTimeout"</span> <span class="attr">value</span>=<span class="string">"4000"</span> /&gt;</span></span><br><span class="line">&gt; <span class="comment">&lt;!-- socketè¯»å†™æ—¶è¶…æ—¶æ—¶é—´(æ¯«ç§’)ï¼Œé»˜è®¤ä¸º0ï¼Œä¸è¶…æ—¶ --&gt;</span></span><br><span class="line">&gt; <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"socketTimeout"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">&gt; <span class="comment">&lt;!-- æ˜¯socketè¿æ¥åœ¨é˜²ç«å¢™ä¸Šä¿æŒæ´»åŠ¨çš„ç‰¹æ€§ï¼Œé»˜è®¤ä¸ºfalse --&gt;</span></span><br><span class="line">&gt; <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"socketKeepAlive"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">&gt;     ...</span><br><span class="line">&gt; <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.dao.DataAccessResourceFailureException: can<span class="string">'t say something; nested exception is com.mongodb.MongoException$Network: can'</span>t say something</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoExceptionTranslator.translateExceptionIfPossible(MongoExceptionTranslator.java:<span class="number">56</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.potentiallyConvertRuntimeException(MongoTemplate.java:<span class="number">1828</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.execute(MongoTemplate.java:<span class="number">409</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.insertDBObject(MongoTemplate.java:<span class="number">893</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.doInsert(MongoTemplate.java:<span class="number">713</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.insert(MongoTemplate.java:<span class="number">668</span>)</span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.insert(MongoTemplate.java:<span class="number">659</span>)</span><br><span class="line">        at net.okdi.o2o.core.helper.ExceptionHelper.afterThrow(ExceptionHelper.java:<span class="number">71</span>)</span><br><span class="line">        at sun.reflect.GeneratedMethodAccessor438.invoke(Unknown Source)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">606</span>)</span><br><span class="line">        ...</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1145</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">615</span>)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</span><br><span class="line">Caused by: com.mongodb.MongoException$Network: can<span class="string">'t say something</span></span><br><span class="line"><span class="string">        at com.mongodb.DBTCPConnector.say(DBTCPConnector.java:194)</span></span><br><span class="line"><span class="string">        at com.mongodb.DBTCPConnector.say(DBTCPConnector.java:155)</span></span><br><span class="line"><span class="string">        at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:249)</span></span><br><span class="line"><span class="string">        at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:205)</span></span><br><span class="line"><span class="string">        at com.mongodb.DBCollection.insert(DBCollection.java:57)</span></span><br><span class="line"><span class="string">        at com.mongodb.DBCollection.insert(DBCollection.java:100)</span></span><br><span class="line"><span class="string">        at org.springframework.data.mongodb.core.MongoTemplate$8.doInCollection(MongoTemplate.java:898)</span></span><br><span class="line"><span class="string">        at org.springframework.data.mongodb.core.MongoTemplate.execute(MongoTemplate.java:407)</span></span><br><span class="line"><span class="string">        ... 44 more</span></span><br><span class="line"><span class="string">Caused by: java.io.IOException: couldn'</span>t connect to [mongodb.xxx.com/<span class="number">192.168</span>.1.22:<span class="number">27017</span>] bc:java.net.SocketTimeoutException: connect timed out</span><br><span class="line">        at com.mongodb.DBPort._open(DBPort.java:<span class="number">214</span>)</span><br><span class="line">        at com.mongodb.DBPort.go(DBPort.java:<span class="number">107</span>)</span><br><span class="line">        at com.mongodb.DBPort.go(DBPort.java:<span class="number">88</span>)</span><br><span class="line">        at com.mongodb.DBPort.findOne(DBPort.java:<span class="number">143</span>)</span><br><span class="line">        at com.mongodb.DBPort.runCommand(DBPort.java:<span class="number">148</span>)</span><br><span class="line">        at com.mongodb.DBPort.checkAuth(DBPort.java:<span class="number">307</span>)</span><br><span class="line">        at com.mongodb.DBTCPConnector.say(DBTCPConnector.java:<span class="number">180</span>)</span><br><span class="line">        ... <span class="number">51</span> more</span><br></pre></td></tr></table></figure><p><strong>è§£å†³ï¼š</strong> å¼‚å¸¸æœ€åå¾ˆæ˜ç¡®çš„æç¤ºäº† <code>connect timed out</code> è¿æ¥è¶…æ—¶çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>connectTimeout</code> è¿æ¥è¶…æ—¶å±æ€§é€‚å½“æ‰©å¤§ï¼Œå¦‚æœæ˜¯æç¤º <code>read timed out</code>ï¼ŒåŸå› æ˜¯åœ¨è¿›è¡Œæ•°æ®æ“ä½œæ—¶è¿‡é•¿æ—¶é—´æ²¡æœ‰è¿”å›ç»“æœï¼Œæ­¤æ—¶è¦ä¿®æ”¹ <code>socketTimeout</code> å±æ€§äº†ã€‚</p><p><a href="https://zyjustin9.iteye.com/blog/2017986" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Tomcat-å®¹å™¨å¯åŠ¨é—®é¢˜&quot;&gt;&lt;a href=&quot;#Tomcat-å®¹å™¨å¯åŠ¨é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;Tomcat å®¹å™¨å¯åŠ¨é—®é¢˜&quot;&gt;&lt;/a&gt;Tomcat å®¹å™¨å¯åŠ¨é—®é¢˜&lt;/h3&gt;&lt;blockquote&gt;
&lt;h4 id=&quot;å‰æ&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="å·¥ä½œè®°å½•" scheme="https://tryme.wang/tags/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot war åŒ…æ–¹å¼å¯åŠ¨é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/spring-boot-war-problems/"/>
    <id>https://tryme.wang/2019/01/spring-boot-war-problems/</id>
    <published>2019-01-03T16:57:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Spring Boot æ”¯æŒ jar åŒ…å’Œ war åŒ…ä¸¤ç§æ‰“åŒ…æ–¹å¼ã€‚jar åŒ…æ–¹å¼è¿è¡Œç®€å•ï¼Œå¯¹äºè½»é‡çš„é¡¹ç›®ï¼Œä»æ„é€ åˆ°éƒ¨ç½²æå¤§çš„æå‡äº†æ•ˆç‡ï¼›war åŒ…æ–¹å¼å¯¹äºå¯åŠ¨å‚æ•°ã€é›†ç¾¤é…ç½®æ¥è¯´å¯èƒ½æ›´æ–¹ä¾¿ä¸€äº›ã€‚åœ¨ä½¿ç”¨ war åŒ…æ–¹å¼çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸‹æ¥ğŸ“ã€‚</p></blockquote><h2 id="å‰ææ¦‚è¦"><a href="#å‰ææ¦‚è¦" class="headerlink" title="å‰ææ¦‚è¦"></a>å‰ææ¦‚è¦</h2><ul><li>Spring Boot ç‰ˆæœ¬<code>2.0.3.RELEASE</code></li><li><p>æ‰“åŒ…æ–¹å¼  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- JDK1.8 ç¼–ç  UTF-8</span><br><span class="line">- ä¾èµ–åªå¼•å…¥äº†``` spring-boot-starter-webã€spring-boot-starter-test</span><br></pre></td></tr></table></figure></p></li><li><p>Tomcat ç‰ˆæœ¬ 7.0.82</p></li></ul><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>é…ç½®å¥½é¡¹ç›®åŠ Tomcat éƒ¨ç½²åå¯åŠ¨å¤±è´¥ï¼Œæœ‰è¿™ä¹ˆä¸€è¡Œå¼‚å¸¸ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.NoClassDefFoundError: javax/el/ELManager</span><br></pre></td></tr></table></figure></p><h2 id="è§£å†³è·¯å¾„"><a href="#è§£å†³è·¯å¾„" class="headerlink" title="è§£å†³è·¯å¾„"></a>è§£å†³è·¯å¾„</h2><h3 id="ç¼ºå°‘-jar-åŒ…"><a href="#ç¼ºå°‘-jar-åŒ…" class="headerlink" title="ç¼ºå°‘ jar åŒ…"></a>ç¼ºå°‘ jar åŒ…</h3><p>ç¬¬ä¸€ååº”ï¼Œç¼ºå°‘ jar åŒ…ï¼Œåœ¨ pom æ–‡ä»¶å¼•å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.el&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.el-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>é‡æ–°å¯åŠ¨åé—®é¢˜ä»ç„¶å­˜åœ¨ï¼ŒåŠ å…¥ <code>&lt;scope&gt;provided&lt;/scope&gt;</code>  åä»ç„¶ä¸è¡Œï¼Œ<code>å¤±è´¥</code>ã€‚</p><h3 id="hibernate-validator-ç‰ˆæœ¬è¿‡é«˜"><a href="#hibernate-validator-ç‰ˆæœ¬è¿‡é«˜" class="headerlink" title="hibernate-validator ç‰ˆæœ¬è¿‡é«˜"></a>hibernate-validator ç‰ˆæœ¬è¿‡é«˜</h3><p>æœç´¢åæœ‰æ–‡ç« è¯´æ˜¯ <code>å½“å‰ç‰ˆæœ¬çš„ Spring Bootï¼Œä¾èµ–çš„éªŒè¯ hibernate-validator ç‰ˆæœ¬å¤ªé«˜ï¼Œå¯¼è‡´æ‰¾ä¸åˆ° ELManagerã€‚</code>æŸ¥çœ‹é¡¹ç›®ä¾èµ–æ ‘ï¼Œå‘ç°æ˜¯web ä¾èµ–ä¸­çš„<br><img src="https://wx3.sinaimg.cn/large/007jb4T5ly1fxq7hr323fj31ag0n4wj5.jpg" align="center" alt="image"><br>æŸ¥çœ‹å…¶ä»–é¡¹ç›®ä¸­åŒæ ·å†™æ³•å¹¶ä¸æŠ¥é”™ï¼Œæ’é™¤è¿™ç§åŸå› ã€‚</p><h3 id="Tomcat-ç‰ˆæœ¬"><a href="#Tomcat-ç‰ˆæœ¬" class="headerlink" title="Tomcat ç‰ˆæœ¬"></a>Tomcat ç‰ˆæœ¬</h3><p>æœ‰äººè¯´ Tomcat7 æä¾›çš„ el-api.jar ç‰ˆæœ¬æ˜¯ 2.2ï¼ŒTomcat8 çš„ç‰ˆæœ¬æ˜¯ 3.0ï¼Œæœªå°è¯•åˆ‡æ¢ Tomcatç‰ˆæœ¬ã€‚</p><h3 id="æœ€ç»ˆè§£å†³"><a href="#æœ€ç»ˆè§£å†³" class="headerlink" title="æœ€ç»ˆè§£å†³"></a>æœ€ç»ˆè§£å†³</h3><p>å°†ä¸‹è½½çš„ el-api3.0 çš„ jar åŒ…æ‹·è´åˆ° $TOMCAT_HOME/lib ä¸‹æ›¿æ¢ä¹‹å‰çš„ el-api.jar å³å¯ã€‚</p><p><code>å‚è€ƒåœ°å€ï¼š</code><a href="https://stackoverflow.com/questions/45841464/java-lang-noclassdeffounderror-javax-el-elmanager" target="_blank" rel="noopener">stackoverflow</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Spring Boot æ”¯æŒ jar åŒ…å’Œ war åŒ…ä¸¤ç§æ‰“åŒ…æ–¹å¼ã€‚jar åŒ…æ–¹å¼è¿è¡Œç®€å•ï¼Œå¯¹äºè½»é‡çš„é¡¹ç›®ï¼Œä»æ„é€ åˆ°éƒ¨ç½²æå¤§çš„æå‡äº†æ•ˆç‡ï¼›war åŒ…æ–¹å¼å¯¹äºå¯åŠ¨å‚æ•°ã€é›†ç¾¤é…ç½®æ¥è¯´å¯èƒ½æ›´æ–¹ä¾¿ä¸€äº›ã€‚åœ¨ä½¿ç”¨ war åŒ…æ–¹å¼çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œè®°å½•ä¸‹æ¥ï¿½
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Spring Boot" scheme="https://tryme.wang/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot ä½¿ç”¨ä¸­çš„å°é—®é¢˜æ€»ç»“</title>
    <link href="https://tryme.wang/2019/01/spring-boot-use-problems/"/>
    <id>https://tryme.wang/2019/01/spring-boot-use-problems/</id>
    <published>2019-01-03T15:57:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Spring Boot ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜æ€»ç»“ï¼ŒæŒç»­æ›´æ–°â€¦</p></blockquote><h3 id="IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜"><a href="#IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜" class="headerlink" title="IDEA ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜"></a>IDEA ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜</h3><p>é—®é¢˜å¦‚å›¾ï¼š<br><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1fxrefyccolj30vq06smza.jpg" align="center" alt="image"><br>è§£å†³æ–¹æ¡ˆï¼š<br>å¼•å…¥å¦‚ä¸‹ä¾èµ–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶ä¼šå‡ºç°å¦‚ä¸‹å›¾ï¼š<br><img src="https://wx3.sinaimg.cn/large/007jb4T5ly1fxrem3cjo3j31dk06idin.jpg" align="center" alt="image"><br>å¯ä»¥ç›´æ¥å¿½ç•¥ã€‚</p><hr><h3 id="Tomcat-å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜"><a href="#Tomcat-å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜" class="headerlink" title="Tomcat å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜"></a>Tomcat å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜</h3><p>å¯åŠ¨é¡¹ç›®æ—¶ï¼Œæ˜æ˜ä¸€ä¸ªå¾ˆç®€å•çš„é¡¹ç›®ï¼Œå´å¯åŠ¨å¾ˆæ…¢ï¼ŒTomcat æ—¥å¿—ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [20,617] milliseconds.</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨æˆåŠŸè€—æ—¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO: Server startup in 33239 ms</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªè­¦å‘Šçš„æ“ä½œè€—äº†å¤§åŠçš„å¯åŠ¨æ—¶é—´ï¼ŒæŸ¥é˜… Tomcat çš„<a href="https://wiki.apache.org/tomcat/HowTo/FasterStartUp" target="_blank" rel="noopener">wiki</a>å‘ç°è¿™ä¹ˆä¸€æ®µè¯ï¼š<br><img src="https://wx1.sinaimg.cn/large/007jb4T5ly1fxtkl2jdatj31xs0iqwmv.jpg" align="center" alt="image"><br>è§£é‡Šå¾—å¾ˆæ¸…æ¥šï¼ŒTomcat å¯åŠ¨æ—¶ç†µæºçš„ç”Ÿæˆé»˜è®¤æ˜¯ JRE çš„é˜»å¡å¼ç†µæºï¼ˆ/ dev / randomï¼‰ï¼Œæ›¿æ¢ä¸ºéé˜»å¡å¼ç†µæºï¼ˆ/ dev /./ urandomï¼‰å³å¯ï¼Œä½†æ˜¯ä¼šé™ä½å®‰å…¨æ€§ï¼Œå› ä¸ºè·å¾—çš„éšæœºæ•°æ®è¾ƒå°‘ã€‚<br>ä¿®æ”¹æ–¹å¼ï¼š<br>ç›´æ¥ä¿®æ”¹ $JAVA_HOME/jre/lib/security/java.security ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">securerandom.source=file:/dev/./urandom</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…ç›´æ¥æ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar app.jar -Djava.security.egd=file:/dev/./urandom</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹å®Œå†å¯åŠ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO: Server startup in 10847 ms</span><br></pre></td></tr></table></figure></p><p>æ•ˆæœè¿˜æ˜¯å¾ˆæ˜¾è‘—çš„ğŸ˜Šã€‚</p><hr><h3 id="é™æ€å˜é‡çš„æ³¨å…¥"><a href="#é™æ€å˜é‡çš„æ³¨å…¥" class="headerlink" title="é™æ€å˜é‡çš„æ³¨å…¥"></a>é™æ€å˜é‡çš„æ³¨å…¥</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸€èˆ¬å¸¸ç”¨çš„å·¥å…·ä¼šæŠ½å–åˆ°å·¥å…·ç±»ä¸­ï¼Œå·¥å…·ç±»ä¸­çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯é™æ€è°ƒç”¨çš„ï¼Œæ–¹æ³•ä¸­å¯èƒ½ä¼šæ³¨å…¥å…¶ä»–æˆå‘˜å˜é‡ï¼Œç”±äºæ–¹æ³•æ˜¯ static çš„ï¼Œæ‰€ä»¥æˆå‘˜å˜é‡ä¹Ÿå¿…é¡»æ˜¯é™æ€çš„ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ @Autowired å·²ç»æ— æ³•æ³¨å…¥ï¼Œæ­¤æ—¶å°±éœ€è¦æ–°çš„æ“ä½œäº†ğŸ˜ã€‚<br>é¦–å…ˆï¼Œå°†éœ€è¦ä½¿ç”¨çš„å®šä¹‰ä¸ºé™æ€å˜é‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static RestTemplate restTemplate;</span><br></pre></td></tr></table></figure></p><p>ç„¶åç”Ÿæˆ set æ–¹æ³•å¹¶åœ¨æ–¹æ³•ä¸ŠåŠ  @Autowiredï¼ˆè¯»å–å±æ€§æ–‡ä»¶çš„è¯ä½¿ç”¨ @Valueï¼‰æ³¨è§£ï¼ˆæ³¨æ„ä¸è¦åŠ  staticï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">    public void setRestTemplate(RestTemplate restTemplate) &#123;</span><br><span class="line">        AuthTokenUtil.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>æœ€åï¼Œç±»ä¸ŠåŠ ä¸Š @Componentæ³¨è§£å³å¯ã€‚</p><hr><h3 id="RestTemplate-çš„-GET-è¯·æ±‚çš„-Headers-è®¾ç½®"><a href="#RestTemplate-çš„-GET-è¯·æ±‚çš„-Headers-è®¾ç½®" class="headerlink" title="RestTemplate çš„ GET è¯·æ±‚çš„ Headers è®¾ç½®"></a>RestTemplate çš„ GET è¯·æ±‚çš„ Headers è®¾ç½®</h3><h4 id="RestTemplate-ä»‹ç»"><a href="#RestTemplate-ä»‹ç»" class="headerlink" title="RestTemplate ä»‹ç»"></a>RestTemplate ä»‹ç»</h4><blockquote><p><strong>Springâ€™s central class for synchronous client-side HTTP access.</strong> It simplifies communication with HTTP servers, and enforces RESTful principles. It handles HTTP connections, leaving application code to provide URLs (with possible template variables) and extract results.</p><p>Spring çš„åŒæ­¥å®¢æˆ·ç«¯ HTTP è®¿é—®çš„ä¸­å¿ƒç±»ã€‚å®ƒç®€åŒ–äº†ä¸ HTTP æœåŠ¡å™¨çš„é€šä¿¡ï¼Œå¹¶å®æ–½äº† RESTful åŸåˆ™ã€‚å®ƒå¤„ç† HTTP è¿æ¥ï¼Œä½¿åº”ç”¨ç¨‹åºä»£ç æä¾› URLï¼ˆå¸¦æœ‰å¯èƒ½çš„æ¨¡æ¿å˜é‡ï¼‰å¹¶æå–ç»“æœã€‚</p></blockquote><h4 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h4><ul><li>Spring Boot ç‰ˆæœ¬ 2.0.3.RELEASE</li><li>spring-web-5.0.7.RELEASE.jar çš„ RestTemplate</li><li>RestTemplate çš„é…ç½®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.SimpleClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tryme.wang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-11-30 10:59:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> RestTemplateé…ç½® </span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(ClientHttpRequestFactory factory)</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(factory);</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpRequestFactory <span class="title">simpleClientHttpRequestFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é»˜è®¤æƒ…å†µä¸‹ï¼ŒRestTemplateä¾èµ–äºæ ‡å‡†JDKå·¥å…·æ¥å»ºç«‹HTTPè¿æ¥ã€‚</span></span><br><span class="line"><span class="comment">         * å¯ä»¥é€šè¿‡InterceptingHttpAccessor.setRequestFactoryï¼ˆorg.springframework.http.client.ClientHttpRequestFactoryï¼‰</span></span><br><span class="line"><span class="comment">         * å±æ€§åˆ‡æ¢åˆ°ä½¿ç”¨ä¸åŒçš„HTTPåº“ï¼Œä¾‹å¦‚Apache HttpComponentsï¼ŒNettyå’ŒOkHttpã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SimpleClientHttpRequestFactory factory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setReadTimeout(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setConnectTimeout(<span class="number">15000</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h4><p>RestTemplate ä½¿ç”¨æ—¶å¯èƒ½ä¼šæœ‰ Headers ä¸­éœ€è¦ä¼ å…¥ token ä¹‹ç±»å‚æ•°çš„æƒ…å†µï¼Œä½¿ç”¨ POST è¯·æ±‚æ—¶ï¼ŒRestTemplate çš„ API ä¸­æœ‰æ˜æ˜¾çš„æ–¹æ³•postForEntityæˆ–postForObjectï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fy68yplwsxj31fu10qgs8.jpg" align="center" alt="image"></p><p>ç„¶è€Œ GET è¯·æ±‚å¹¶æ²¡æœ‰æ˜æ˜¾å¯ä»¥ç†è§£çš„ API ä½¿ç”¨ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°äº† exchange æ–¹æ³•å¯ä»¥æŒ‡å®š HTTP è¯·æ±‚æ–¹å¼ï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fy6979u3i3j31fo0x4n2l.jpg" align="center" alt="image"></p><p>okï¼Œå°±å®ƒäº†ï¼Œè€Œä¸”å…¶ä»–è¯·æ±‚æ–¹å¼å‡å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥æ‰§è¡Œ Headersã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Spring Boot ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜æ€»ç»“ï¼ŒæŒç»­æ›´æ–°â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜&quot;&gt;&lt;a href=&quot;#IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;I
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Spring Boot" scheme="https://tryme.wang/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>RestTemplate è‡ªå®šä¹‰ ErrorHandler</title>
    <link href="https://tryme.wang/2019/01/resttemplate-errorhandler/"/>
    <id>https://tryme.wang/2019/01/resttemplate-errorhandler/</id>
    <published>2019-01-03T15:45:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ä½¿ç”¨ Spring Boot çš„ RestTemplate è°ƒç”¨æ—¶ï¼Œå‘ç°è°ƒç”¨æˆåŠŸæ—¶å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿”å› 4xx æˆ–è€… 5xx å¼‚å¸¸æ—¶ï¼Œè¿™è´§ç›´æ¥ç»™æŠ›å‡ºæ¥äº†ï¼Œæƒ³è¦å¤„ç†å¯ä»¥è‡ªå®šä¹‰ ErrorHandlerã€‚</p></blockquote><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å½“æœåŠ¡ç«¯è¿”å›é 200 æ—¶ï¼Œè°ƒç”¨æ–¹ç›´æ¥æŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.client.HttpClientErrorException: <span class="number">400</span> Bad Request</span><br><span class="line"></span><br><span class="line">at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:<span class="number">94</span>)</span><br><span class="line">at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:<span class="number">79</span>)</span><br><span class="line">at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:<span class="number">63</span>)</span><br><span class="line">at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:<span class="number">766</span>)</span><br><span class="line">at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:<span class="number">724</span>)</span><br><span class="line">at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:<span class="number">680</span>)</span><br><span class="line">at org.springframework.web.client.RestTemplate.postForEntity(RestTemplate.java:<span class="number">466</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p><p>ä¸ºä»€ä¹ˆä¼šæŠ›å¼‚å¸¸å‘¢ï¼Œå¯ä»¥ç¿»ä¸€ä¸‹æºç ï¼š<br>RestTemplate ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">ResponseEntity&lt;T&gt; <span class="title">postForEntity</span><span class="params">(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</span><br><span class="line">        RequestCallback requestCallback = <span class="keyword">this</span>.httpEntityCallback(request, responseType);</span><br><span class="line">        ResponseExtractor&lt;ResponseEntity&lt;T&gt;&gt; responseExtractor = <span class="keyword">this</span>.responseEntityExtractor(responseType);</span><br><span class="line">        <span class="keyword">return</span> (ResponseEntity)nonNull(<span class="keyword">this</span>.execute(url, HttpMethod.POST, requestCallback, responseExtractor, uriVariables));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­ç¿»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">execute</span><span class="params">(String url, HttpMethod method, @Nullable RequestCallback requestCallback, @Nullable ResponseExtractor&lt;T&gt; responseExtractor, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</span><br><span class="line">        URI expanded = <span class="keyword">this</span>.getUriTemplateHandler().expand(url, uriVariables);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.doExecute(expanded, method, requestCallback, responseExtractor);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>å†å¾€ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">doExecute</span><span class="params">(URI url, @Nullable HttpMethod method, @Nullable RequestCallback requestCallback, @Nullable ResponseExtractor&lt;T&gt; responseExtractor)</span> <span class="keyword">throws</span> RestClientException </span>&#123;</span><br><span class="line">        Assert.notNull(url, <span class="string">"URI is required"</span>);</span><br><span class="line">        Assert.notNull(method, <span class="string">"HttpMethod is required"</span>);</span><br><span class="line">        ClientHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        Object var14;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClientHttpRequest request = <span class="keyword">this</span>.createRequest(url, method);</span><br><span class="line">            <span class="keyword">if</span> (requestCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                requestCallback.doWithRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            response = request.execute();</span><br><span class="line">            <span class="keyword">this</span>.handleResponse(url, method, response);</span><br><span class="line">            var14 = responseExtractor != <span class="keyword">null</span> ? responseExtractor.extractData(response) : <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var12) &#123;</span><br><span class="line">            String resource = url.toString();</span><br><span class="line">            String query = url.getRawQuery();</span><br><span class="line">            resource = query != <span class="keyword">null</span> ? resource.substring(<span class="number">0</span>, resource.indexOf(<span class="number">63</span>)) : resource;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ResourceAccessException(<span class="string">"I/O error on "</span> + method.name() + <span class="string">" request for \""</span> + resource + <span class="string">"\": "</span> + var12.getMessage(), var12);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> var14;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleResponse</span><span class="params">(URI url, HttpMethod method, ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ResponseErrorHandler errorHandler = <span class="keyword">this</span>.getErrorHandler();</span><br><span class="line">        <span class="keyword">boolean</span> hasError = errorHandler.hasError(response);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(method.name() + <span class="string">" request for \""</span> + url + <span class="string">"\" resulted in "</span> + response.getRawStatusCode() + <span class="string">" ("</span> + response.getStatusText() + <span class="string">")"</span> + (hasError ? <span class="string">"; invoking error handler"</span> : <span class="string">""</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException var7) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hasError) &#123;</span><br><span class="line">            errorHandler.handleError(url, method, response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ç»ˆäºçœ‹åˆ°äº†æƒ³è¦çš„ï¼Œå¯ä»¥çœ‹å‡º hasError ä¸º trueï¼Œå³æœ‰é”™è¯¯æ—¶ï¼Œä¼šèµ° errorHandler.handleError(url, method, response)ï¼Œæ¥ä¸‹æ¥ç»§ç»­æŸ¥çœ‹è¿™ä¸ª errorHandler çš„æºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResponseErrorHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">(ClientHttpResponse var1)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">handleError</span><span class="params">(ClientHttpResponse var1)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(URI url, HttpMethod method, ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handleError(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬ç‚¹è¿›å®ƒçš„å®ç°ç±» DefaultResponseErrorHandler çš„ handleError()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HttpStatus statusCode = HttpStatus.resolve(response.getRawStatusCode());</span><br><span class="line">        <span class="keyword">if</span> (statusCode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownHttpStatusCodeException(response.getRawStatusCode(), response.getStatusText(), response.getHeaders(), <span class="keyword">this</span>.getResponseBody(response), <span class="keyword">this</span>.getCharset(response));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.handleError(response, statusCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­å¾€ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(ClientHttpResponse response, HttpStatus statusCode)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(statusCode.series()) &#123;</span><br><span class="line">        <span class="keyword">case</span> CLIENT_ERROR:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> HttpClientErrorException(statusCode, response.getStatusText(), response.getHeaders(), <span class="keyword">this</span>.getResponseBody(response), <span class="keyword">this</span>.getCharset(response));</span><br><span class="line">        <span class="keyword">case</span> SERVER_ERROR:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> HttpServerErrorException(statusCode, response.getStatusText(), response.getHeaders(), <span class="keyword">this</span>.getResponseBody(response), <span class="keyword">this</span>.getCharset(response));</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownHttpStatusCodeException(statusCode.value(), response.getStatusText(), response.getHeaders(), <span class="keyword">this</span>.getResponseBody(response), <span class="keyword">this</span>.getCharset(response));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ç®—æ‰¾åˆ°åŸå› äº†ï¼ŒåŸæ¥åœ¨è¿™é‡ŒæŠ›å‡ºäº†ä¸€ä¸ª HttpClientErrorExceptionï¼Œæ—¢ç„¶ DefaultResponseErrorHandler å®ç°äº† ResponseErrorHandlerï¼Œè€Œä¸”ä»åå­—ä¸Šçœ‹è²Œä¼¼æ˜¯ä¸ªé»˜è®¤çš„é”™è¯¯å¤„ç†ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°è¯•è‡ªå®šä¹‰ ErrorHandler å®ç° ResponseErrorHandler æ¥å¤„ç†å¼‚å¸¸æƒ…å†µã€‚</p><h3 id="è‡ªå®šä¹‰-ErrorHandler"><a href="#è‡ªå®šä¹‰-ErrorHandler" class="headerlink" title="è‡ªå®šä¹‰ ErrorHandler"></a>è‡ªå®šä¹‰ ErrorHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.DefaultResponseErrorHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tryme.wang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-12-03 11:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> è¿œç¨‹è°ƒç”¨è‡ªå®šä¹‰å¼‚å¸¸Handler</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestErrorHandler</span> <span class="keyword">extends</span> <span class="title">DefaultResponseErrorHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// æ˜¯å¦æœ‰é”™ è¿”å›falseå³æ‰‹åŠ¨è®¾ç½®äº†ä¸ç®¡responseæ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰é”™</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// æš‚æ—¶ç©ºç€</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«å¿˜è®°é…ç½®è¿›å»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.merrichat.im.common.handler.RestErrorHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.SimpleClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tryme.wang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-11-30 10:59:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> httpè¯·æ±‚é…ç½® ï¼ˆæ›¿ä»£httpclientï¼‰</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(ClientHttpRequestFactory factory)</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(factory);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ErrorHandler</span></span><br><span class="line">        restTemplate.setErrorHandler(<span class="keyword">new</span> RestErrorHandler());</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpRequestFactory <span class="title">simpleClientHttpRequestFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleClientHttpRequestFactory factory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setReadTimeout(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setConnectTimeout(<span class="number">15000</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æ— è®ºæœåŠ¡ç«¯è¿”å›ä»€ä¹ˆçŠ¶æ€ç ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šè®¤ä¸ºæ²¡é”™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–æƒ³è¦çš„ statusCode æˆ–è€… body è¿›è€Œæ¥å¤„ç†å„ç§ä¸šåŠ¡äº†ğŸ˜‰ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ Spring Boot çš„ RestTemplate è°ƒç”¨æ—¶ï¼Œå‘ç°è°ƒç”¨æˆåŠŸæ—¶å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿”å› 4xx æˆ–è€… 5xx å¼‚å¸¸æ—¶ï¼Œè¿™è´§ç›´æ¥ç»™æŠ›å‡ºæ¥äº†ï¼Œæƒ³è¦å¤„ç†å¯ä»¥è‡ªå®šä¹‰ ErrorHandlerã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Spring Boot" scheme="https://tryme.wang/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>MySQL å­—æ®µé»˜è®¤å€¼çš„é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/mysql-column-default-value/"/>
    <id>https://tryme.wang/2019/01/mysql-column-default-value/</id>
    <published>2019-01-03T15:40:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><p>ä½¿ç”¨ SQL è„šæœ¬åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼ŒSQL è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table test</span><br><span class="line">(</span><br><span class="line">   ...</span><br><span class="line">   create_time          datetime not null default now() comment &apos;åˆ›å»ºæ—¶é—´&apos;,</span><br><span class="line">   ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>åœ¨ä¸ºâ€create_timeâ€œå­—æ®µè®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´æ—¶ï¼ŒSQL æ‰§è¡ŒæŠ¥äº†ä¸€ä¸ªé”™è¯¯å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[42000][1067] Invalid default value for &apos;create_time&apos;</span><br></pre></td></tr></table></figure><p>å­—æ®µé»˜è®¤å€¼æ— æ•ˆçš„åŸå› ï¼ŒæŸ¥çœ‹äº†ä¸‹å½“å‰çš„ MySQL ç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+------------+</span><br><span class="line">| version()  |</span><br><span class="line">+------------+</span><br><span class="line">| 5.5.35-log |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬æ˜¯ 5.5 çš„ã€‚</p><h3 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h3><p>æŸ¥çœ‹äº† <a href="https://dev.mysql.com/doc/refman/5.5/en/data-type-defaults.html" target="_blank" rel="noopener">MySQL 5.5</a> çš„æ–‡æ¡£ï¼Œåœ¨ Data Type Default Values è¿™ä¸€æ®µä¸­æœ‰è¿™ä¹ˆä¸ªæè¿°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">With one exception, the default value specified in a DEFAULT clause must be a literal constant; it cannot be a function or an expression. This means, for example, that you cannot set the default for a date column to be the value of a function such as NOW() or CURRENT_DATE. The exception is that, for a TIMESTAMP column, you can specify CURRENT_TIMESTAMP as the default. See Section 11.3.5, â€œAutomatic Initialization and Updating for TIMESTAMPâ€. </span><br><span class="line">ï¼ˆé™¤äº†ä¸€ä¸ªä¾‹å¤–ï¼ŒDEFAULTå­å¥ä¸­æŒ‡å®šçš„é»˜è®¤å€¼å¿…é¡»æ˜¯æ–‡å­—å¸¸é‡;å®ƒä¸èƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½æˆ–è¡¨è¾¾ã€‚è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½å°†æ—¥æœŸåˆ—çš„é»˜è®¤å€¼è®¾ç½®ä¸ºå‡½æ•°çš„å€¼ï¼Œä¾‹å¦‚NOWï¼ˆï¼‰æˆ–CURRENT_DATEã€‚ä¾‹å¤–æƒ…å†µæ˜¯ï¼Œå¯¹äºTIMESTAMPåˆ—ï¼Œæ‚¨å¯ä»¥å°†CURRENT_TIMESTAMPæŒ‡å®šä¸ºé»˜è®¤å€¼ã€‚è¯·å‚è§ç¬¬11.3.5èŠ‚â€œTIMESTAMPçš„è‡ªåŠ¨åˆå§‹åŒ–å’Œæ›´æ–°â€ã€‚ï¼‰</span><br></pre></td></tr></table></figure><p>åŸå› å¾ˆæ˜æ˜¾äº†ï¼ŒDEFAULT æŒ‡å®šçš„é»˜è®¤å€¼ä¸èƒ½æ˜¯ NOW() ï¼Œå¯ä»¥å°† â€create_timeâ€œå­—æ®µçš„ç±»å‹æ”¹ä¸º TIMESTAMPï¼Œå†å°†é»˜è®¤å€¼è®¾ä¸º CURRENT_TIMESTAMP æ¥ä½¿ç”¨ã€‚</p><p><strong>PSï¼š</strong>MySQL 5.6/5.7 ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºé»˜è®¤å€¼çš„æè¿°æœ‰æ‰€å˜åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">With one exception, the default value specified in a DEFAULT clause must be a literal constant; it cannot be a function or an expression. This means, for example, that you cannot set the default for a date column to be the value of a function such as NOW() or CURRENT_DATE. The exception is that, for TIMESTAMP and DATETIME columns, you can specify CURRENT_TIMESTAMP as the default. See Section 11.3.5, â€œAutomatic Initialization and Updating for TIMESTAMP and DATETIMEâ€. </span><br><span class="line">ï¼ˆé™¤äº†ä¸€ä¸ªä¾‹å¤–ï¼ŒDEFAULTå­å¥ä¸­æŒ‡å®šçš„é»˜è®¤å€¼å¿…é¡»æ˜¯æ–‡å­—å¸¸é‡;å®ƒä¸èƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½æˆ–è¡¨è¾¾ã€‚è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½å°†æ—¥æœŸåˆ—çš„é»˜è®¤å€¼è®¾ç½®ä¸ºå‡½æ•°çš„å€¼ï¼Œä¾‹å¦‚NOWï¼ˆï¼‰æˆ–CURRENT_DATEã€‚ä¾‹å¤–æƒ…å†µæ˜¯ï¼Œå¯¹äºTIMESTAMPå’ŒDATETIMEåˆ—ï¼Œæ‚¨å¯ä»¥å°†CURRENT_TIMESTAMPæŒ‡å®šä¸ºé»˜è®¤å€¼ã€‚è¯·å‚è§ç¬¬11.3.5èŠ‚â€œTIMESTAMPå’ŒDATETIMEçš„è‡ªåŠ¨åˆå§‹åŒ–å’Œæ›´æ–°â€ã€‚ï¼‰</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåç»­ç‰ˆæœ¬ä¸­ DATETIME ç±»å‹çš„å­—æ®µä¹Ÿå¯ä»¥å°† CURRENT_TIMESTAMP è®¾ä¸ºé»˜è®¤å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‰æ&quot;&gt;&lt;a href=&quot;#å‰æ&quot; class=&quot;headerlink&quot; title=&quot;å‰æ&quot;&gt;&lt;/a&gt;å‰æ&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ SQL è„šæœ¬åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼ŒSQL è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://tryme.wang/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Dubbo å‘å¸ƒçš„æœåŠ¡å’Œ AOP æ— æ³•å…±å­˜çš„é—®é¢˜</title>
    <link href="https://tryme.wang/2019/01/dubbo-service-aop-conflict/"/>
    <id>https://tryme.wang/2019/01/dubbo-service-aop-conflict/</id>
    <published>2019-01-03T15:33:40.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Spring Boot ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜æ€»ç»“ï¼ŒæŒç»­æ›´æ–°â€¦</p></blockquote><h3 id="IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜"><a href="#IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜" class="headerlink" title="IDEA ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜"></a>IDEA ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜</h3><p>é—®é¢˜å¦‚å›¾ï¼š<br><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1fxrefyccolj30vq06smza.jpg" align="center" alt="image"><br>è§£å†³æ–¹æ¡ˆï¼š<br>å¼•å…¥å¦‚ä¸‹ä¾èµ–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶ä¼šå‡ºç°å¦‚ä¸‹å›¾ï¼š<br><img src="https://wx3.sinaimg.cn/large/007jb4T5ly1fxrem3cjo3j31dk06idin.jpg" align="center" alt="image"><br>å¯ä»¥ç›´æ¥å¿½ç•¥ã€‚</p><hr><h3 id="Tomcat-å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜"><a href="#Tomcat-å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜" class="headerlink" title="Tomcat å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜"></a>Tomcat å®¹å™¨å¯åŠ¨è¿‡æ…¢çš„é—®é¢˜</h3><p>å¯åŠ¨é¡¹ç›®æ—¶ï¼Œæ˜æ˜ä¸€ä¸ªå¾ˆç®€å•çš„é¡¹ç›®ï¼Œå´å¯åŠ¨å¾ˆæ…¢ï¼ŒTomcat æ—¥å¿—ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [20,617] milliseconds.</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨æˆåŠŸè€—æ—¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO: Server startup in 33239 ms</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªè­¦å‘Šçš„æ“ä½œè€—äº†å¤§åŠçš„å¯åŠ¨æ—¶é—´ï¼ŒæŸ¥é˜… Tomcat çš„<a href="https://wiki.apache.org/tomcat/HowTo/FasterStartUp" target="_blank" rel="noopener">wiki</a>å‘ç°è¿™ä¹ˆä¸€æ®µè¯ï¼š<br><img src="https://wx1.sinaimg.cn/large/007jb4T5ly1fxtkl2jdatj31xs0iqwmv.jpg" align="center" alt="image"><br>è§£é‡Šå¾—å¾ˆæ¸…æ¥šï¼ŒTomcat å¯åŠ¨æ—¶ç†µæºçš„ç”Ÿæˆé»˜è®¤æ˜¯ JRE çš„é˜»å¡å¼ç†µæºï¼ˆ/ dev / randomï¼‰ï¼Œæ›¿æ¢ä¸ºéé˜»å¡å¼ç†µæºï¼ˆ/ dev /./ urandomï¼‰å³å¯ï¼Œä½†æ˜¯ä¼šé™ä½å®‰å…¨æ€§ï¼Œå› ä¸ºè·å¾—çš„éšæœºæ•°æ®è¾ƒå°‘ã€‚<br>ä¿®æ”¹æ–¹å¼ï¼š<br>ç›´æ¥ä¿®æ”¹ $JAVA_HOME/jre/lib/security/java.security ä¸­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">securerandom.source=file:/dev/./urandom</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…ç›´æ¥æ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar app.jar -Djava.security.egd=file:/dev/./urandom</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹å®Œå†å¯åŠ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO: Server startup in 10847 ms</span><br></pre></td></tr></table></figure></p><p>æ•ˆæœè¿˜æ˜¯å¾ˆæ˜¾è‘—çš„ğŸ˜Šã€‚</p><hr><h3 id="é™æ€å˜é‡çš„æ³¨å…¥"><a href="#é™æ€å˜é‡çš„æ³¨å…¥" class="headerlink" title="é™æ€å˜é‡çš„æ³¨å…¥"></a>é™æ€å˜é‡çš„æ³¨å…¥</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸€èˆ¬å¸¸ç”¨çš„å·¥å…·ä¼šæŠ½å–åˆ°å·¥å…·ç±»ä¸­ï¼Œå·¥å…·ç±»ä¸­çš„æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯é™æ€è°ƒç”¨çš„ï¼Œæ–¹æ³•ä¸­å¯èƒ½ä¼šæ³¨å…¥å…¶ä»–æˆå‘˜å˜é‡ï¼Œç”±äºæ–¹æ³•æ˜¯ static çš„ï¼Œæ‰€ä»¥æˆå‘˜å˜é‡ä¹Ÿå¿…é¡»æ˜¯é™æ€çš„ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ @Autowired å·²ç»æ— æ³•æ³¨å…¥ï¼Œæ­¤æ—¶å°±éœ€è¦æ–°çš„æ“ä½œäº†ğŸ˜ã€‚<br>é¦–å…ˆï¼Œå°†éœ€è¦ä½¿ç”¨çš„å®šä¹‰ä¸ºé™æ€å˜é‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static RestTemplate restTemplate;</span><br></pre></td></tr></table></figure></p><p>ç„¶åç”Ÿæˆ set æ–¹æ³•å¹¶åœ¨æ–¹æ³•ä¸ŠåŠ  @Autowiredï¼ˆè¯»å–å±æ€§æ–‡ä»¶çš„è¯ä½¿ç”¨ @Valueï¼‰æ³¨è§£ï¼ˆæ³¨æ„ä¸è¦åŠ  staticï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">    public void setRestTemplate(RestTemplate restTemplate) &#123;</span><br><span class="line">        AuthTokenUtil.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>æœ€åï¼Œç±»ä¸ŠåŠ ä¸Š @Componentæ³¨è§£å³å¯ã€‚</p><hr><h3 id="RestTemplate-çš„-GET-è¯·æ±‚çš„-Headers-è®¾ç½®"><a href="#RestTemplate-çš„-GET-è¯·æ±‚çš„-Headers-è®¾ç½®" class="headerlink" title="RestTemplate çš„ GET è¯·æ±‚çš„ Headers è®¾ç½®"></a>RestTemplate çš„ GET è¯·æ±‚çš„ Headers è®¾ç½®</h3><h4 id="RestTemplate-ä»‹ç»"><a href="#RestTemplate-ä»‹ç»" class="headerlink" title="RestTemplate ä»‹ç»"></a>RestTemplate ä»‹ç»</h4><blockquote><p><strong>Springâ€™s central class for synchronous client-side HTTP access.</strong> It simplifies communication with HTTP servers, and enforces RESTful principles. It handles HTTP connections, leaving application code to provide URLs (with possible template variables) and extract results.</p><p>Spring çš„åŒæ­¥å®¢æˆ·ç«¯ HTTP è®¿é—®çš„ä¸­å¿ƒç±»ã€‚å®ƒç®€åŒ–äº†ä¸ HTTP æœåŠ¡å™¨çš„é€šä¿¡ï¼Œå¹¶å®æ–½äº† RESTful åŸåˆ™ã€‚å®ƒå¤„ç† HTTP è¿æ¥ï¼Œä½¿åº”ç”¨ç¨‹åºä»£ç æä¾› URLï¼ˆå¸¦æœ‰å¯èƒ½çš„æ¨¡æ¿å˜é‡ï¼‰å¹¶æå–ç»“æœã€‚</p></blockquote><h4 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h4><ul><li>Spring Boot ç‰ˆæœ¬ 2.0.3.RELEASE</li><li>spring-web-5.0.7.RELEASE.jar çš„ RestTemplate</li><li>RestTemplate çš„é…ç½®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.ClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.SimpleClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> tryme.wang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2018-11-30 10:59:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> RestTemplateé…ç½® </span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(ClientHttpRequestFactory factory)</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(factory);</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpRequestFactory <span class="title">simpleClientHttpRequestFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * é»˜è®¤æƒ…å†µä¸‹ï¼ŒRestTemplateä¾èµ–äºæ ‡å‡†JDKå·¥å…·æ¥å»ºç«‹HTTPè¿æ¥ã€‚</span></span><br><span class="line"><span class="comment">         * å¯ä»¥é€šè¿‡InterceptingHttpAccessor.setRequestFactoryï¼ˆorg.springframework.http.client.ClientHttpRequestFactoryï¼‰</span></span><br><span class="line"><span class="comment">         * å±æ€§åˆ‡æ¢åˆ°ä½¿ç”¨ä¸åŒçš„HTTPåº“ï¼Œä¾‹å¦‚Apache HttpComponentsï¼ŒNettyå’ŒOkHttpã€‚</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SimpleClientHttpRequestFactory factory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setReadTimeout(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">// å•ä½ï¼šms</span></span><br><span class="line">        factory.setConnectTimeout(<span class="number">15000</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h4><p>RestTemplate ä½¿ç”¨æ—¶å¯èƒ½ä¼šæœ‰ Headers ä¸­éœ€è¦ä¼ å…¥ token ä¹‹ç±»å‚æ•°çš„æƒ…å†µï¼Œä½¿ç”¨ POST è¯·æ±‚æ—¶ï¼ŒRestTemplate çš„ API ä¸­æœ‰æ˜æ˜¾çš„æ–¹æ³•postForEntityæˆ–postForObjectï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fy68yplwsxj31fu10qgs8.jpg" align="center" alt="image"></p><p>ç„¶è€Œ GET è¯·æ±‚å¹¶æ²¡æœ‰æ˜æ˜¾å¯ä»¥ç†è§£çš„ API ä½¿ç”¨ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°äº† exchange æ–¹æ³•å¯ä»¥æŒ‡å®š HTTP è¯·æ±‚æ–¹å¼ï¼š</p><p><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fy6979u3i3j31fo0x4n2l.jpg" align="center" alt="image"></p><p>okï¼Œå°±å®ƒäº†ï¼Œè€Œä¸”å…¶ä»–è¯·æ±‚æ–¹å¼å‡å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥æ‰§è¡Œ Headersã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Spring Boot ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜æ€»ç»“ï¼ŒæŒç»­æ›´æ–°â€¦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜&quot;&gt;&lt;a href=&quot;#IDEA-ä¸­è¯»å–é…ç½®æ–‡ä»¶é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;I
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Spring Boot" scheme="https://tryme.wang/tags/Spring-Boot/"/>
    
      <category term="Dubbo" scheme="https://tryme.wang/tags/Dubbo/"/>
    
  </entry>
  
  <entry>
    <title>Aria2&amp;AriaNGã€OneIndex é…ç½®</title>
    <link href="https://tryme.wang/2018/11/aria2-oneindex/"/>
    <id>https://tryme.wang/2018/11/aria2-oneindex/</id>
    <published>2018-11-24T09:38:16.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Aria2-ä»‹ç»"><a href="#Aria2-ä»‹ç»" class="headerlink" title="Aria2 ä»‹ç»"></a>Aria2 ä»‹ç»</h2><blockquote><p>aria2 is a lightweight multi-protocol &amp; multi-source command-line download utility. It supports HTTP/HTTPS, FTP, SFTP, BitTorrent and Metalink. aria2 can be manipulated via built-in JSON-RPC and XML-RPC interfaces.    (from <a href="https://aria2.github.io" target="_blank" rel="noopener">https://aria2.github.io</a>)</p></blockquote><h2 id="å®‰è£…-Aria2"><a href="#å®‰è£…-Aria2" class="headerlink" title="å®‰è£… Aria2"></a>å®‰è£… Aria2</h2><p>ä¸‹è½½è„šæœ¬å¹¶è¿è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/aria2.sh &amp;&amp; chmod +x aria2.sh &amp;&amp; bash aria2.sh</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œè„šæœ¬åä¼šå‡ºç°ä»¥ä¸‹èœå•é€‰é¡¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> Aria2 ä¸€é”®å®‰è£…ç®¡ç†è„šæœ¬ [v1.1.9]</span><br><span class="line">  -- Toyo | doub.io/shell-jc4 --</span><br><span class="line">  </span><br><span class="line">  0. å‡çº§è„šæœ¬</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">  1. å®‰è£… Aria2</span><br><span class="line">  2. æ›´æ–° Aria2</span><br><span class="line">  3. å¸è½½ Aria2</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">  4. å¯åŠ¨ Aria2</span><br><span class="line">  5. åœæ­¢ Aria2</span><br><span class="line">  6. é‡å¯ Aria2</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line">  7. ä¿®æ”¹ é…ç½®æ–‡ä»¶</span><br><span class="line">  8. æŸ¥çœ‹ é…ç½®ä¿¡æ¯</span><br><span class="line">  9. æŸ¥çœ‹ æ—¥å¿—ä¿¡æ¯</span><br><span class="line"> 10. é…ç½® è‡ªåŠ¨æ›´æ–° BT-TrackeræœåŠ¡å™¨</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line"> å½“å‰çŠ¶æ€: å·²å®‰è£… å¹¶ å·²å¯åŠ¨</span><br><span class="line"></span><br><span class="line"> è¯·è¾“å…¥æ•°å­— [0-10]:</span><br></pre></td></tr></table></figure></p><p>æŒ‰æç¤ºæ“ä½œå³å¯ã€‚<br>PS:<br><strong>å¯åŠ¨ï¼š</strong> /etc/init.d/aria2 start<br><strong>åœæ­¢ï¼š</strong> /etc/init.d/aria2 stop<br><strong>å½“å‰çŠ¶æ€ï¼š</strong> /etc/init.d/aria2 status<br><strong>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</strong> /root/.aria2/aria2.conf<br><strong>ä»¤ç‰Œå¯†é’¥ï¼š</strong> éšæœºç”Ÿæˆï¼Œå¯ä»¥æ›´æ”¹<br><strong>ä¸‹è½½ç›®å½•ï¼š</strong>/usr/local/caddy/www/aria2/Download<br><code>æ¥æºï¼š<a href="https://doub.io/shell-jc4/" target="_blank" rel="noopener">é€—æ¯”æ•™ç¨‹</a></code></p><hr><h2 id="å®‰è£…-AriaNG"><a href="#å®‰è£…-AriaNG" class="headerlink" title="å®‰è£… AriaNG"></a>å®‰è£… AriaNG</h2><blockquote><p>ç”±äº Aria2 æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œä¸‹è½½å·¥å…·ï¼Œæ¯æ¬¡ä½¿ç”¨æ•²å‘½ä»¤ä¸‹è½½æ–‡ä»¶ä¸æ–¹ä¾¿ï¼Œæœ‰å¤§ä½¬å¼€å‘å‡ºçš„å¼€æº WEB é¢æ¿æ¥ç®¡ç†ä¸‹è½½ä»»åŠ¡ã€‚å…¶ä¸­ä¹‹ä¸€ä¾¿æ˜¯ <a href="https://github.com/mayswind/AriaNg" target="_blank" rel="noopener">AriaNG</a>ã€‚<br>AriaNG åªæ˜¯ä¸€ä¸ª WEB ç«¯çš„ç®¡ç†é¢æ¿ï¼Œå¯ä»¥è¿œç¨‹è¿æ¥ Aria2ï¼ŒäºŒè€…å¯ä»¥åˆ†å¤„ä¸åŒæœåŠ¡å™¨ã€‚</p></blockquote><p>ç›´æ¥ä» <a href="https://github.com/mayswind/AriaNg/releases" target="_blank" rel="noopener">GitHub</a> é¡¹ç›®ä¸»é¡µä¸‹è½½è§£å‹åˆ°æœåŠ¡å™¨å³å¯ï¼Œæ­¤æ—¶å³å¯é€šè¿‡ IP æˆ–é…ç½®å¥½çš„åŸŸåè¿›è¡Œè®¿é—®ã€‚<br>å…·ä½“æ•ˆæœå¯è®¿é—® <code><a href="http://aria2.tryme.wang" target="_blank" rel="noopener">http://aria2.tryme.wang</a></code>æŸ¥çœ‹</p><hr><h2 id="å®‰è£…-OneIndex"><a href="#å®‰è£…-OneIndex" class="headerlink" title="å®‰è£… OneIndex"></a>å®‰è£… OneIndex</h2><p>å¯ä»¥ä½¿ç”¨å®å¡”é¢æ¿æ–°å»ºç½‘ç«™ï¼Œå…¨ç¨‹ WEB é¢æ¿æ“ä½œï¼Œç®€å•ç²—æš´ã€‚å®‰è£…å‚è€ƒï¼š<a href="https://bt.cn" target="_blank" rel="noopener">å®å¡”</a><br>OneIndex é¡¹ç›®ä¸»é¡µï¼š<a href="https://github.com/donwa/oneindex" target="_blank" rel="noopener">https://github.com/donwa/oneindex</a><br><img src="https://ws2.sinaimg.cn/large/007jb4T5ly1fx7n9vix1aj30me0j0t9u.jpg" align="center" alt="image"><br>ä¸‹è½½ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/donwa/oneindex.git</span><br></pre></td></tr></table></figure></p><p>ç§»åŠ¨åˆ°ç½‘ç«™æ ¹ç›®å½•åè¦åˆ†é…æƒé™ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 ./config &amp;&amp; chmod 777 ./cache</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶æ ¹æ®é…ç½®çš„åŸŸåï¼Œè®¿é—® <code> <a href="http://xxx.com/?/admin" target="_blank" rel="noopener">http://xxx.com/?/admin</a></code>ï¼Œé»˜è®¤çš„å¯†ç æ˜¯  <code>oneindex</code>ï¼ŒæŒ‰ç…§æç¤ºé…ç½®å³å¯ã€‚<br>PSï¼šå¯ä»¥é…ç½® Nginx ä¼ªé™æ€å»æ‰ç®¡ç†é¡µé¢ URL ä¸­çš„â€œ?â€ï¼Œä¼ªé™æ€é…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">    rewrite / /?/ last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="é…ç½®-Aria2-ä¸‹è½½åè‡ªåŠ¨ä¸Šä¼ "><a href="#é…ç½®-Aria2-ä¸‹è½½åè‡ªåŠ¨ä¸Šä¼ " class="headerlink" title="é…ç½® Aria2 ä¸‹è½½åè‡ªåŠ¨ä¸Šä¼ "></a>é…ç½® Aria2 ä¸‹è½½åè‡ªåŠ¨ä¸Šä¼ </h2><p>æ–°å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /root/.aria2/oneindexup.sh</span><br></pre></td></tr></table></figure></p><p>å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">path=<span class="variable">$3</span> <span class="comment">#å–åŸå§‹è·¯å¾„ï¼Œæˆ‘çš„ç¯å¢ƒä¸‹å¦‚æœæ˜¯å•æ–‡ä»¶åˆ™ä¸º/data/demo.png,å¦‚æœæ˜¯æ–‡ä»¶å¤¹åˆ™è¯¥å€¼ä¸ºæ–‡ä»¶å¤¹å†…æŸä¸ªæ–‡ä»¶æ¯”å¦‚/data/a/b/c/d.jpg</span></span><br><span class="line">downloadpath=<span class="string">'/usr/local/caddy/www/aria2/Download'</span>  <span class="comment">#ä¿®æ”¹æˆAria2ä¸‹è½½æ–‡ä»¶å¤¹</span></span><br><span class="line">domain=<span class="string">'tryme.wang'</span>  <span class="comment">#ä¿®æ”¹æˆè‡ªå·±åŸŸå</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$2</span> -eq 0 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span>  <span class="comment">#æå–ä¸‹è½½æ–‡ä»¶æ ¹è·¯å¾„ï¼Œå¦‚æŠŠ/data/a/b/c/d.jpgå˜æˆ/data/a</span></span><br><span class="line">filepath=<span class="variable">$path</span></span><br><span class="line">path=<span class="variable">$&#123;path%/*&#125;</span>; </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$path</span>"</span> = <span class="string">"<span class="variable">$downloadpath</span>"</span> ] &amp;&amp; [ <span class="variable">$2</span> -eq 1 ]  <span class="comment">#å¦‚æœä¸‹è½½çš„æ˜¯å•ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    php /www/wwwroot/<span class="variable">$domain</span>/one.php upload:file <span class="variable">$filepath</span> /<span class="variable">$folder</span>/</span><br><span class="line">    rm -rf <span class="variable">$filepath</span></span><br><span class="line">    php /www/wwwroot/<span class="variable">$domain</span>/one.php cache:refresh</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$path</span>"</span> = <span class="string">"<span class="variable">$downloadpath</span>"</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    php /www/wwwroot/<span class="variable">$domain</span>/one.php upload:folder <span class="variable">$filepath</span> /<span class="variable">$folder</span>/</span><br><span class="line">    rm -rf <span class="string">"<span class="variable">$filepath</span>/"</span></span><br><span class="line">    php /www/wwwroot/<span class="variable">$domain</span>/one.php cache:refresh</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p><p>ç»™è„šæœ¬åˆ†é…å¯æ‰§è¡Œæƒé™ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /root/.aria2/oneindexup.sh</span><br></pre></td></tr></table></figure></p><p>æœ€åå†™å…¥é…ç½®æ–‡ä»¶ï¼Œå³ä¸Šé¢å®‰è£… Aria2 æ—¶çš„é…ç½®æ–‡ä»¶ <code>/root/.aria2/aria2.conf</code><br>ç¼–è¾‘é…ç½®æ–‡ä»¶æˆ–è€…ç›´æ¥å‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"on-download-complete=/root/.aria2/oneindexup.sh"</span> &gt;&gt;/root/.aria2/aria2.conf</span><br></pre></td></tr></table></figure></p><p><code>å‚è€ƒè‡ªï¼š<a href="https://www.moerats.com/archives/700/" target="_blank" rel="noopener">Ratâ€˜så¤§ä½¬</a></code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Aria2-ä»‹ç»&quot;&gt;&lt;a href=&quot;#Aria2-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Aria2 ä»‹ç»&quot;&gt;&lt;/a&gt;Aria2 ä»‹ç»&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;aria2 is a lightweight multi-prot
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Aria2" scheme="https://tryme.wang/tags/Aria2/"/>
    
      <category term="OneIndex" scheme="https://tryme.wang/tags/OneIndex/"/>
    
  </entry>
  
  <entry>
    <title>Openfire é›†æˆå·²æœ‰æ•°æ®åº“ç”¨æˆ·</title>
    <link href="https://tryme.wang/2018/11/openfire-database/"/>
    <id>https://tryme.wang/2018/11/openfire-database/</id>
    <published>2018-11-24T09:37:15.000Z</published>
    <updated>2019-01-04T01:47:33.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Openfire å®‰è£…å®Œæˆåï¼Œåå°ä¼šé»˜è®¤åœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­ç”Ÿæˆ of* ç­‰è®¸å¤šè¡¨ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾€å¾€éœ€è¦é›†æˆå·²æœ‰çš„æ•°æ®åº“è¡¨ï¼Œå¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿå±æ€§æ¥å®ç°ï¼ˆç”¨æˆ·è®¤è¯ï¼Œä¸åŒ…å«ç¾¤ç»„ï¼‰ã€‚</p></blockquote><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>é¦–å…ˆï¼Œä¸šåŠ¡ç³»ç»Ÿä¸­éœ€å­˜åœ¨ç”¨æˆ·è®¤è¯ç›¸å…³ä¿¡æ¯è¡¨ä»¥ä¾¿é›†æˆã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> im_user</span><br><span class="line">(</span><br><span class="line">member_id <span class="built_in">bigint</span> <span class="literal">null</span>,</span><br><span class="line">mobile <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">null</span>,</span><br><span class="line">email <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">null</span>,</span><br><span class="line">username <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">null</span>,</span><br><span class="line"><span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="literal">null</span>,</span><br><span class="line">create_time <span class="keyword">timestamp</span> <span class="literal">null</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h2 id="æ›´æ”¹-ofproperty-è¡¨"><a href="#æ›´æ”¹-ofproperty-è¡¨" class="headerlink" title="æ›´æ”¹ ofproperty è¡¨"></a>æ›´æ”¹ ofproperty è¡¨</h2><p>ç³»ç»Ÿé»˜è®¤éªŒè¯ç±»ï¼š<br><img src="https://wx1.sinaimg.cn/large/007jb4T5ly1fwh86yvbbyj31ie07i40l.jpg" alt="image" style="display:block;margin:0 auto;"><br>Openfire æä¾›äº† MySQL æ•°æ®åº“çš„éªŒè¯ç±»ï¼Œè·¯å¾„ä¸º org.jivesoftware.openfire.auth.JDBCAuthProviderï¼Œä»¥åŠç”¨æˆ·ç›¸å…³çš„æ“ä½œç±»org.jivesoftware.openfire.user.JDBCUserProviderï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°å»ºç›¸å…³å±æ€§ã€æ›´æ”¹éªŒè¯æ–¹å¼å’Œç”¨æˆ·ç›¸å…³æ“ä½œæ¥è¾¾åˆ°ä½¿ç”¨å·²æœ‰ MySQL æ•°æ®åº“è¡¨çš„ç›®çš„ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥æ–°å»ºç³»ç»Ÿå±æ€§ï¼ˆåŒæ ·å¯ä»¥åœ¨ç®¡ç†é¡µé¢æ“ä½œï¼‰ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`myopenfire`</span>.ofproperty(<span class="keyword">name</span>,propValue)<span class="keyword">values</span></span><br><span class="line">(<span class="string">'admin.authorizedJIDs'</span>,<span class="string">'admin@localhost'</span>),</span><br><span class="line">(<span class="string">'jdbcProvider.driver'</span>,<span class="string">'com.mysql.jdbc.Driver'</span>),</span><br><span class="line">(<span class="string">'jdbcProvider.connectionString'</span>,<span class="string">'jdbc:mysql://192.168.53.61:3306/myopenfire?user=test&amp;password=test&amp;rewriteBatchedStatements=true&amp;useUnicode=true&amp;characterEncoding=utf8'</span>),</span><br><span class="line">(<span class="string">'jdbcAuthProvider.passwordSQL'</span>,<span class="string">'SELECT password FROM im_user WHERE mobile=?'</span>),</span><br><span class="line">(<span class="string">'jdbcAuthProvider.passwordType'</span>,<span class="string">'plain'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.loadUserSQL'</span>,<span class="string">'SELECT username,email FROM im_user WHERE mobile=?'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.userCountSQL'</span>,<span class="string">'SELECT COUNT(*) FROM im_user'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.allUsersSQL'</span>,<span class="string">'SELECT username FROM im_user'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.usernameField'</span>,<span class="string">'username'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.nameField'</span>,<span class="string">'mobile'</span>),</span><br><span class="line">(<span class="string">'jdbcUserProvider.emailField'</span>,<span class="string">'email'</span>);</span><br></pre></td></tr></table></figure></p><p>å°†ç³»ç»Ÿå±æ€§æ›´æ”¹ä¸ºä»¥ä¸Šä¸¤ä¸ªç±»å³å¯ã€‚</p><blockquote><p>admin.authorizedJIDs å±æ€§å³ç®¡ç†å‘˜è´¦æˆ·åç§°ï¼Œ@ åæ˜¯åˆå§‹é…ç½®çš„åŸŸï¼Œå¿…é¡»å¸¦ä¸Šï¼Œå¹¶ä¸” im_user è¡¨ä¸­å¿…é¡»æœ‰ admin ç›¸å…³çš„éªŒè¯ä¿¡æ¯æ‰èƒ½ç™»å½•ç®¡ç†é¡µé¢ã€‚</p></blockquote><p>å‚è€ƒï¼š<a href="http://download.igniterealtime.org/openfire/docs/latest/documentation/db-integration-guide.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Openfire å®‰è£…å®Œæˆåï¼Œåå°ä¼šé»˜è®¤åœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­ç”Ÿæˆ of* ç­‰è®¸å¤šè¡¨ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­å¾€å¾€éœ€è¦é›†æˆå·²æœ‰çš„æ•°æ®åº“è¡¨ï¼Œå¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿå±æ€§æ¥å®ç°ï¼ˆç”¨æˆ·è®¤è¯ï¼Œä¸åŒ…å«ç¾¤ç»„ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="IDEA" scheme="https://tryme.wang/tags/IDEA/"/>
    
      <category term="Openfire" scheme="https://tryme.wang/tags/Openfire/"/>
    
  </entry>
  
  <entry>
    <title>IDEA å¯¼å…¥ Openfire æºç </title>
    <link href="https://tryme.wang/2018/11/import-openfire-source/"/>
    <id>https://tryme.wang/2018/11/import-openfire-source/</id>
    <published>2018-11-24T09:35:12.000Z</published>
    <updated>2019-01-04T01:47:37.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Openfire æ˜¯ä¸€ä¸ªæ˜¯ä¸€ä¸ª IMï¼ˆå³æ—¶é€šè®¯ï¼‰æœåŠ¡å™¨ï¼Œä½¿ç”¨ Java ç¼–å†™çš„ XMPP æœåŠ¡å™¨ï¼Œå¼€å‘è¿‡ç¨‹ Intellij IDEA å¯¼å…¥ Openfire æºç æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p></blockquote><h2 id="ä¸‹è½½æºç "><a href="#ä¸‹è½½æºç " class="headerlink" title="ä¸‹è½½æºç "></a>ä¸‹è½½æºç </h2><p>ä» GitHub é¡¹ç›®ä¸»é¡µ<a href="https://github.com/igniterealtime/Openfire" target="_blank" rel="noopener">ä¸‹è½½</a>æºç æˆ–è€…ä»å®˜ç½‘<a href="https://www.igniterealtime.org/projects/openfire/" target="_blank" rel="noopener">ä¸‹è½½</a>ã€‚</p><hr><h2 id="å¯¼å…¥åˆ°-IDEA-ä¸­"><a href="#å¯¼å…¥åˆ°-IDEA-ä¸­" class="headerlink" title="å¯¼å…¥åˆ° IDEA ä¸­"></a>å¯¼å…¥åˆ° IDEA ä¸­</h2><h3 id="é€‰æ‹©-Import-Project"><a href="#é€‰æ‹©-Import-Project" class="headerlink" title="é€‰æ‹© Import Project"></a>é€‰æ‹© Import Project</h3><p><img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fwh4u917jfj30lu0keq3s.jpg" alt="image" style="display:block;margin:0 auto;"><br>ä¸€è·¯nextå³å¯å¯¼å…¥æˆåŠŸã€‚</p><h3 id="è¿›è¡Œæ„å»º"><a href="#è¿›è¡Œæ„å»º" class="headerlink" title="è¿›è¡Œæ„å»º"></a>è¿›è¡Œæ„å»º</h3><p>æ³¨æ„ï¼šç”±äºéœ€è¦ ant ç›¸å…³ jar åŒ…ï¼Œå¯ä»¥<a href="https://ant.apache.org/bindownload.cgi" target="_blank" rel="noopener">ä¸‹è½½</a>ä¹‹åï¼Œå°† ant.jar å¯¼å…¥åˆ° $JAVA_HOME/jre/lib ç›®å½•ä¸‹å³å¯ã€‚<br><img src="https://ws1.sinaimg.cn/large/007jb4T5ly1fwh59sa2qrj31j80os44v.jpg" alt="image" style="display:block;margin:0 auto;"><br>æ·»åŠ ä¹‹åè¿›è¡Œç¼–è¯‘æŠ¥é”™ï¼š<br><img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fwh5amisywj31as0k0acw.jpg" style="display:block;margin:0 auto;"><br>è§£å†³ï¼šé…ç½® JDK<br><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fwh5e3ra57j31h20ligpd.jpg" alt="image" style="display:block;margin:0 auto;"></p><p>é…ç½® application<br> <img src="https://ws4.sinaimg.cn/large/007jb4T5ly1fwh5fgxstfj31t4188tdw.jpg" alt="image" style="display:block;margin:0 auto;"></p><h3 id="å¯åŠ¨åº”ç”¨"><a href="#å¯åŠ¨åº”ç”¨" class="headerlink" title="å¯åŠ¨åº”ç”¨"></a>å¯åŠ¨åº”ç”¨</h3><p>æˆåŠŸå¯åŠ¨åè¿›å…¥ <a href="http://localhost:9000" target="_blank" rel="noopener">http://localhost:9000</a> é¡µé¢æŠ¥é”™å¦‚ä¸‹ï¼š<br><img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fwh5gy3gm6j31a00ziwrr.jpg" alt="image" style="display:block;margin:0 auto;"><br>è§£å†³ï¼šå°† $OPENFIRE_HOME/src/resources/jar/admin-sidebar.xmlåŠ$OPENFIRE_HOME/resources/i18n ä¸‹æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°è¾“å‡ºç›®å½•ã€‚<br><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1fwh5me9vf7j317m0i0acs.jpg" alt="image" style="display:block;margin:0 auto;"><br><img src="https://ws1.sinaimg.cn/large/007jb4T5ly1fwh5mreoutj30yq0k4q6b.jpg" alt="image" style="display:block;margin:0 auto;"><br>è¾“å‡ºç›®å½•ï¼š<br><img src="https://ws1.sinaimg.cn/large/007jb4T5ly1fwh5namvjsj319w0k2q72.jpg" alt="image" style="display:block;margin:0 auto;"><br>å†æ¬¡å¯åŠ¨å³å¯è¿›å…¥åˆå§‹åŒ–é…ç½®é¡µé¢ã€‚</p><h3 id="ç®¡ç†é¡µé¢é…ç½®"><a href="#ç®¡ç†é¡µé¢é…ç½®" class="headerlink" title="ç®¡ç†é¡µé¢é…ç½®"></a>ç®¡ç†é¡µé¢é…ç½®</h3><p>æ ¹æ®æç¤ºé…ç½®å³å¯ã€‚<br><img src="https://ws4.sinaimg.cn/large/007jb4T5ly1fwh729eol1j31y00yuwj2.jpg" alt="image" style="display:block;margin:0 auto;"><br><img src="https://wx2.sinaimg.cn/large/007jb4T5ly1fwh72p0gioj318c0l0whe.jpg" alt="image" style="display:block;margin:0 auto;"><br><img src="https://ws4.sinaimg.cn/large/007jb4T5ly1fwh73l1dxmj31hc0p443e.jpg" alt="image" style="display:block;margin:0 auto;"><br><img src="https://wx4.sinaimg.cn/large/007jb4T5ly1fwh73xkewoj31w20hiade.jpg" alt="image" style="display:block;margin:0 auto;"></p><p>è‡³æ­¤ï¼ŒIDEA å¯¼å…¥ Openfire æºç å®Œæˆï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Openfire æ˜¯ä¸€ä¸ªæ˜¯ä¸€ä¸ª IMï¼ˆå³æ—¶é€šè®¯ï¼‰æœåŠ¡å™¨ï¼Œä½¿ç”¨ Java ç¼–å†™çš„ XMPP æœåŠ¡å™¨ï¼Œå¼€å‘è¿‡ç¨‹ Intellij IDEA å¯¼å…¥ Openfire æºç æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä¸‹è½½æº
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://tryme.wang/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="IDEA" scheme="https://tryme.wang/tags/IDEA/"/>
    
      <category term="Openfire" scheme="https://tryme.wang/tags/Openfire/"/>
    
  </entry>
  
  <entry>
    <title>å®‰è£… RSS æœåŠ¡ Tiny Tiny RSS</title>
    <link href="https://tryme.wang/2018/11/install-ttrss/"/>
    <id>https://tryme.wang/2018/11/install-ttrss/</id>
    <published>2018-11-24T09:33:42.000Z</published>
    <updated>2019-01-17T07:41:26.082Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>RSS å·²ç»é€æ¸æ²¡è½ï¼Œè¢«å¦‚ä»Šå¤§æ•°æ®ä¿¡æ¯æµï¼Œæ¨èç®—æ³•æ‰€å–ä»£ã€‚å¦‚ä»Šè™½ç„¶ç”¨çš„äººæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯å¥½åœ¨æ²¡é‚£ä¹ˆå¤šçƒ¦äººçš„â€œä¸“å±å¹¿å‘Šâ€åŠå®£ç§°â€œåƒäººåƒé¢â€çš„ğŸŒ¶ğŸ”ç®—æ³•æ¨èã€‚è™½ç„¶æœ‰å¾ˆå¤š RSS æä¾›å•†ï¼Œä¾‹å¦‚ Feedlyã€Inoreaderç­‰ï¼Œä¹Ÿå„æœ‰å…è´¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å¥½çš„æœåŠ¡ç»ˆç©¶æ˜¯èµ°å‘äº†ä»˜è´¹æ—¶ä»£ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» Docker ä¸‹å®‰è£… Tiny Tiny RSS çš„æ–¹æ³•åŠå¼€å¯ HTTPS æ”¯æŒï¼ŒDocker å¯ä»¥ç†è§£ä¸ºä¸€ç§å®¿ä¸»æœºä¸Šçš„å®Œå…¨éš”ç¦»çš„å®¹å™¨ï¼Œå®‰è£…å¸è½½å®¹å™¨å†…çš„ä¸œè¥¿å®Œå…¨ä¸å½±å“å®¿ä¸»æœºã€‚</p></blockquote><h2 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h2><h3 id="å®‰è£…-Docker-ç¯å¢ƒ"><a href="#å®‰è£…-Docker-ç¯å¢ƒ" class="headerlink" title="å®‰è£… Docker ç¯å¢ƒ"></a>å®‰è£… Docker ç¯å¢ƒ</h3><p>æ‰§è¡Œå‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://get.docker.io/ | sh</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¸»æœºä½äºå›½å†…ï¼Œå¯ä»¥åˆ‡æ¢ä¸ºå›½å†…é•œåƒå®‰è£…è„šæœ¬ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure></p><h3 id="å¼€å§‹éƒ¨ç½²"><a href="#å¼€å§‹éƒ¨ç½²" class="headerlink" title="å¼€å§‹éƒ¨ç½²"></a>å¼€å§‹éƒ¨ç½²</h3><p>å‚è€ƒ <a href="https://github.com/HenryQW/docker-ttrss-plugins" target="_blank" rel="noopener">HenryQW</a> çš„æ–¹æ³•é€šè¿‡ docker-compose éƒ¨ç½²ï¼Œéœ€è¦å®‰è£… docker-compose å‘½ä»¤ï¼Œä¸€æ­¥æ­¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install epel-release</span><br><span class="line">$ yum -y install python-pip</span><br><span class="line">$ pip install docker-compose</span><br></pre></td></tr></table></figure></p><p>docker-compose.yml å†…å®¹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="string">database.postgres:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">sameersbn/postgresql:latest</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">postgres</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">PG_PASSWORD=tt-rss</span> <span class="comment"># please change the password</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_EXTENSION=pg_trgm</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">  rss:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">wangqiru/ttrss:latest</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">ttrss</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">181</span><span class="string">:80</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">SELF_URL_PATH=https://rss.tryme.wang/</span> <span class="comment"># please change to your own domain, keep https there and no port for https support later</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_HOST=database.postgres</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_PORT=5432</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_NAME=ttrss</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_USER=postgres</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">DB_PASS=tt-rss</span> <span class="comment"># please change the password</span></span><br><span class="line"><span class="attr">    stdin_open:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    tty:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">sh</span> <span class="bullet">-c</span> <span class="string">'sh /wait-for database.postgres:5432 -- php /configure-db.php &amp;&amp; exec s6-svscan /etc/s6/'</span></span><br></pre></td></tr></table></figure></p><p>åœ¨ docker-compose.yml ç›®å½•ä¸‹æ‰§è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up -d</span><br></pre></td></tr></table></figure></p><p>ç­‰å¾…éƒ¨ç½²å®Œæˆã€‚</p><h3 id="Nginx-HTTPS-æ”¯æŒ"><a href="#Nginx-HTTPS-æ”¯æŒ" class="headerlink" title="Nginx HTTPS æ”¯æŒ"></a>Nginx HTTPS æ”¯æŒ</h3><p>æ·»åŠ  Nginx yum èµ„æºåº“ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨ yum å‘½ä»¤å®‰è£… Nginxï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y nginx</span><br></pre></td></tr></table></figure></p><p>å¯åŠ¨ Nginxï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service nginx start</span><br></pre></td></tr></table></figure></p><p>è¿™æ—¶è®¿é—®å³å¯çœ‹åˆ°â€œWelcome to Nginxâ€æ¬¢è¿é¡µã€‚</p><blockquote><p>ä½¿ç”¨ <a href="https://letsencrypt.org/" target="_blank" rel="noopener">Letâ€™sEncrypt</a> æä¾›çš„å…è´¹ HTTPS è¯ä¹¦<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://dl.eff.org/certbot-auto</span><br><span class="line">$ chmod a+x ./certbot-auto</span><br><span class="line">$ certbot-auto</span><br></pre></td></tr></table></figure></p></blockquote><p>æ ¹æ®æç¤ºç”Ÿæˆå³å¯ã€‚<br>ç¼–è¾‘/etc/nginx/conf.d/ttrss.confï¼ˆæ²¡æœ‰çš„è¯æ‰‹åŠ¨åˆ›å»ºï¼‰ï¼Œä¿å­˜å¦‚ä¸‹å†…å®¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">upstream ttrssdev &#123;</span><br><span class="line">  server 127.0.0.1:181;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name rss.tryme.wang;</span><br><span class="line">    <span class="comment">#return 301 https://rss.tryme.wang$request_uri;</span></span><br><span class="line">    rewrite ^(.*)$ https://<span class="variable">$host</span><span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    gzip on;</span><br><span class="line">    server_name rss.tryme.wang;</span><br><span class="line">    ssl_certificate /etc/letsencrypt/live/rss.tryme.wang/fullchain.pem;</span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/live/rss.tryme.wang/privkey.pem;</span><br><span class="line">    access_log /var/<span class="built_in">log</span>/nginx/ttrssdev_access.log combined;</span><br><span class="line">    error_log /var/<span class="built_in">log</span>/nginx/ttrssdev_error.log;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_pass http://ttrssdev;</span><br><span class="line">        proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Ssl on;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        proxy_set_header X-Frame-Options SAMEORIGIN;</span><br><span class="line">        client_max_body_size 100m;</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        proxy_buffer_size 4k;</span><br><span class="line">        proxy_buffers 4 32k;</span><br><span class="line">        proxy_busy_buffers_size 64k;</span><br><span class="line">        proxy_temp_file_write_size 64k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>ç¡®ä¿/etc/nginx/nginx.confä¸»é…ç½®æ–‡ä»¶httpå—é‡Œæœ‰â€œinclude /etc/nginx/conf.d/*.conf;â€<br>éªŒè¯å¹¶æ›´æ–° Nginx é…ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nginx -t</span><br><span class="line">$ nginx -s reload</span><br></pre></td></tr></table></figure></p></blockquote><p>è¿™æ˜¯ç›´æ¥è®¿é—® <a href="https://rss.tryme.wang" target="_blank" rel="noopener">https://rss.tryme.wang</a> å³å¯çœ‹åˆ°ç™»å½•é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·å adminï¼Œå¯†ç  passwordï¼Œå»ºè®®ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼</p><h3 id="å¯èƒ½å‡ºç°çš„é—®é¢˜"><a href="#å¯èƒ½å‡ºç°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½å‡ºç°çš„é—®é¢˜"></a>å¯èƒ½å‡ºç°çš„é—®é¢˜</h3><p>GCP çš„æœºå™¨ç›´æ¥è®¿é—®åŸŸåçš„æ—¶å€™ Nginx çš„é”™è¯¯æ—¥å¿—å¯èƒ½ä¼šå‡ºç°ä¸‹é¢é—®é¢˜ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*33 connect() to 127.0.0.1:181 failed (13: Permission denied) while connecting to upstream</span><br></pre></td></tr></table></figure></p><blockquote><p>è§£å†³æ–¹æ¡ˆå‚è€ƒ <a href="https://my.oschina.net/zk875/blog/823710" target="_blank" rel="noopener">åœ°å€</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;RSS å·²ç»é€æ¸æ²¡è½ï¼Œè¢«å¦‚ä»Šå¤§æ•°æ®ä¿¡æ¯æµï¼Œæ¨èç®—æ³•æ‰€å–ä»£ã€‚å¦‚ä»Šè™½ç„¶ç”¨çš„äººæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯å¥½åœ¨æ²¡é‚£ä¹ˆå¤šçƒ¦äººçš„â€œä¸“å±å¹¿å‘Šâ€åŠå®£ç§°â€œåƒäººåƒé¢â€çš„ğŸŒ¶ğŸ”ç®—æ³•æ¨èã€‚è™½ç„¶æœ‰å¾ˆå¤š RSS æä¾›å•†ï¼Œä¾‹å¦‚ Feedlyã€Inoreaderç­‰ï¼Œä¹Ÿå„æœ‰å…è´¹çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å¥½çš„
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="RSS" scheme="https://tryme.wang/tags/RSS/"/>
    
  </entry>
  
  <entry>
    <title>Typecho åŠ å¯†æ–‡ç« æ˜¾ç¤ºæ ‡é¢˜</title>
    <link href="https://tryme.wang/2018/11/typecho-encrypt-show-title/"/>
    <id>https://tryme.wang/2018/11/typecho-encrypt-show-title/</id>
    <published>2018-11-24T09:31:37.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Typecho çš„æ–‡ç« å¯ä»¥åŠ å¯†ï¼Œä½†æ˜¯åŠ å¯†çš„æ–‡ç« æ ‡é¢˜é»˜è®¤æ˜¾ç¤ºçš„æ˜¯â€œæ­¤å†…å®¹è¢«å¯†ç ä¿æŠ¤â€ï¼Œä»€ä¹ˆæ–‡ç« éƒ½ä¸çŸ¥é“ğŸ˜¶ï¼Œä¸è¿‡è¿˜å¥½å¯ä»¥æ›´æ”¹é…ç½®ã€‚ </p></blockquote><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨ $SITE_HOME/var/Widget/Abstract/Contents.php æ–‡ä»¶çš„å¦‚å›¾ä½ç½®ï¼š <img src="https://ws3.sinaimg.cn/large/007jb4T5ly1fxyd2v50mpj31c40ekwh4.jpg" align="center" alt="image"></p><p>å°† <code>$value[â€˜titleâ€™] = _t(â€˜æ­¤å†…å®¹è¢«å¯†ç ä¿æŠ¤â€™)</code> æ³¨é‡Šæ‰å³å¯ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ä¸Šé¢çš„ <code>è¯·è¾“å…¥å¯†ç ä»¥è®¿é—®</code> å’Œ <code>æäº¤</code> ä¸ºè‡ªå®šä¹‰å†…å®¹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Typecho çš„æ–‡ç« å¯ä»¥åŠ å¯†ï¼Œä½†æ˜¯åŠ å¯†çš„æ–‡ç« æ ‡é¢˜é»˜è®¤æ˜¾ç¤ºçš„æ˜¯â€œæ­¤å†…å®¹è¢«å¯†ç ä¿æŠ¤â€ï¼Œä»€ä¹ˆæ–‡ç« éƒ½ä¸çŸ¥é“ğŸ˜¶ï¼Œä¸è¿‡è¿˜å¥½å¯ä»¥æ›´æ”¹é…ç½®ã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;è§£å†³æ–¹æ¡ˆ&quot;&gt;&lt;a href=&quot;#è§£å†³æ–¹æ¡ˆ&quot; class=&quot;hea
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Typecho" scheme="https://tryme.wang/tags/Typecho/"/>
    
  </entry>
  
  <entry>
    <title>Typecho æ–‡ç« æ”¯æŒ emoji</title>
    <link href="https://tryme.wang/2018/11/typecho-support-emoji/"/>
    <id>https://tryme.wang/2018/11/typecho-support-emoji/</id>
    <published>2018-11-24T09:31:37.000Z</published>
    <updated>2019-01-04T01:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ utf-8 æ ¼å¼ç¼–ç æœ€å¤šæ”¯æŒ 3 ä¸ªå­—èŠ‚ï¼Œè€Œ emoji è¡¨æƒ…æ˜¯ 4 ä¸ªå­—èŠ‚çš„ç¬¦å·ï¼Œæ‰€ä»¥ emoji è¡¨æƒ…çš„é•¿åº¦å°±è¶…å‡ºäº†æˆ‘ä»¬å¸¸ç”¨ utf-8 çš„å­—ç¬¦é›†èŒƒå›´è€Œæ— æ³•å­˜å‚¨ã€‚ä» MySQL5.5 å¼€å§‹ï¼Œå¯ä»¥æ›´æ”¹æ•°æ®åº“å’Œæ•°æ®è¡¨çš„ç¼–ç ä¸º utf8mb4 ä½¿å…¶æ”¯æŒå­˜å‚¨ emojiï¼Œutf8mb4 å…¼å®¹ utf8ï¼Œä¸”æ¯” utf8 èƒ½è¡¨ç¤ºæ›´å¤šçš„å­—ç¬¦ï¼Œæ˜¯ utf8 å­—ç¬¦é›†çš„è¶…é›†ã€‚<br>ä¿®æ”¹ä¹‹å‰ä¸€å®šè¦å¤‡ä»½æ•°æ®ï¼ä¿®æ”¹ä¹‹å‰ä¸€å®šè¦å¤‡ä»½æ•°æ®ï¼ä¿®æ”¹ä¹‹å‰ä¸€å®šè¦å¤‡ä»½æ•°æ®ï¼</p></blockquote><h4 id="1-æ›´æ”¹æ•°æ®åº“çš„æ’åºè§„åˆ™"><a href="#1-æ›´æ”¹æ•°æ®åº“çš„æ’åºè§„åˆ™" class="headerlink" title="1. æ›´æ”¹æ•°æ®åº“çš„æ’åºè§„åˆ™"></a>1. æ›´æ”¹æ•°æ®åº“çš„æ’åºè§„åˆ™</h4><p><img src="https://wx3.sinaimg.cn/large/007jb4T5ly1fvfzrk6j8ij31yq10fain.jpg" alt="order-rule"></p><h4 id="2-ç‚¹å‡»-SQL-æŒ‰é’®ï¼Œæ‰§è¡Œä»¥ä¸‹-SQL-è¯­å¥-å°†-Typecho-ä¿®æ”¹ä¸ºè‡ªå·±å¯¹åº”çš„å‰ç¼€"><a href="#2-ç‚¹å‡»-SQL-æŒ‰é’®ï¼Œæ‰§è¡Œä»¥ä¸‹-SQL-è¯­å¥-å°†-Typecho-ä¿®æ”¹ä¸ºè‡ªå·±å¯¹åº”çš„å‰ç¼€" class="headerlink" title="2. ç‚¹å‡» SQL æŒ‰é’®ï¼Œæ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥(å°† Typecho ä¿®æ”¹ä¸ºè‡ªå·±å¯¹åº”çš„å‰ç¼€)"></a>2. ç‚¹å‡» SQL æŒ‰é’®ï¼Œæ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥(å°† Typecho ä¿®æ”¹ä¸ºè‡ªå·±å¯¹åº”çš„å‰ç¼€)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_comments <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_contents <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_fields <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_metas <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_options <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_relationships <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> typecho_users <span class="keyword">convert</span> <span class="keyword">to</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œä¹‹åï¼š<br><img src="https://ws4.sinaimg.cn/large/007jb4T5ly1fvg105ehbxj31ec0mo11c.jpg" alt="after-modified"></p><h4 id="3-ç¼–è¾‘ç½‘ç«™æ ¹ç›®å½•çš„-config-inc-php-æ–‡ä»¶ï¼Œæ–‡ä»¶æœ«å°¾"><a href="#3-ç¼–è¾‘ç½‘ç«™æ ¹ç›®å½•çš„-config-inc-php-æ–‡ä»¶ï¼Œæ–‡ä»¶æœ«å°¾" class="headerlink" title="3. ç¼–è¾‘ç½‘ç«™æ ¹ç›®å½•çš„ config.inc.php æ–‡ä»¶ï¼Œæ–‡ä»¶æœ«å°¾"></a>3. ç¼–è¾‘ç½‘ç«™æ ¹ç›®å½•çš„ config.inc.php æ–‡ä»¶ï¼Œæ–‡ä»¶æœ«å°¾</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å®šä¹‰æ•°æ®åº“å‚æ•° */</span></span><br><span class="line">$db = <span class="keyword">new</span> Typecho_Db(<span class="string">'Pdo_Mysql'</span>, <span class="string">'typecho_'</span>);</span><br><span class="line">$db-&gt;addServer(<span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'user'</span> =&gt; <span class="string">'username'</span>,</span><br><span class="line">  <span class="string">'password'</span> =&gt; <span class="string">'password'</span>,</span><br><span class="line">  <span class="string">'charset'</span> =&gt; <span class="string">'utf8mb4'</span>,<span class="comment">// å°†utf-8ä¿®æ”¹ä¸ºutf8mb4</span></span><br><span class="line">  <span class="string">'port'</span> =&gt; <span class="string">'3306'</span>,</span><br><span class="line">  <span class="string">'database'</span> =&gt; <span class="string">'database-name'</span>,</span><br><span class="line">), Typecho_Db::READ | Typecho_Db::WRITE);</span><br><span class="line">Typecho_Db::set($db);</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä¿®æ”¹å®Œä¹‹åï¼Œæ–‡ç« å³å¯æ”¯æŒ emoji è¡¨æƒ…ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ utf-8 æ ¼å¼ç¼–ç æœ€å¤šæ”¯æŒ 3 ä¸ªå­—èŠ‚ï¼Œè€Œ emoji è¡¨æƒ…æ˜¯ 4 ä¸ªå­—èŠ‚çš„ç¬¦å·ï¼Œæ‰€ä»¥ emoji è¡¨æƒ…çš„é•¿åº¦å°±è¶…å‡ºäº†æˆ‘ä»¬å¸¸ç”¨ utf-8 çš„å­—ç¬¦é›†èŒƒå›´è€Œæ— æ³•å­˜å‚¨ã€‚ä» MySQL5.5 å¼€å§‹ï¼Œå¯ä»¥æ›´æ”¹æ•°æ®åº“å’Œ
      
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://tryme.wang/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Typecho" scheme="https://tryme.wang/tags/Typecho/"/>
    
  </entry>
  
</feed>
